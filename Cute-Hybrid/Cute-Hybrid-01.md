### å‰è¨€

æˆ‘ä»¬å¤§å‰ç«¯å›¢é˜Ÿå†…éƒ¨ ğŸ“–**æ¯å‘¨ä¸€ç»ƒ** çš„çŸ¥è¯†å¤ä¹ è®¡åˆ’è¿˜åœ¨ç»§ç»­ï¼Œæœ¬å‘¨ä¸»é¢˜æ˜¯ **ã€ŠHybrid APP æ··åˆåº”ç”¨ä¸“é¢˜ã€‹** ï¼Œè¿™æœŸå†…å®¹æ¯”è¾ƒå¤šï¼Œç¯‡å¹…ä¹Ÿç›¸å¯¹è¾ƒé•¿ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹å†…å®¹ä¹Ÿæ¯”è¾ƒå¤šã€‚

ä¹‹å‰åˆ†äº«çš„æ¯å‘¨å†…å®¹ï¼Œæˆ‘éƒ½æ•´ç†åˆ°æ˜é‡‘æ”¶è—é›† [ğŸ“”ã€ŠEFTæ¯å‘¨ä¸€ç»ƒã€‹](https://juejin.im/collection/5cd11b0af265da0346227e24) ä¸Šå•¦ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—å’¯ğŸ’•ğŸ’•ã€‚  

> æ³¨ï¼šæœ¬æ–‡æ•´ç†èµ„æ–™æ¥æºç½‘ç»œï¼Œæœ‰äº›å›¾ç‰‡/æ®µè½æ‰¾ä¸åˆ°åŸæ–‡å‡ºå¤„ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè”ç³»åˆ é™¤ã€‚


### ä¸€ã€ä»€ä¹ˆæ˜¯ Hybrid Appï¼Œä¸ Native App åŠ Web App æœ‰ä»€ä¹ˆåŒºåˆ«

å‚è€ƒæ–‡ç« ï¼š

1. [ã€ŠWeb App Hybrid Appå’Œ Native Appçš„åŒºåˆ«ã€‹](http://www.ionic.wang/article-index-id-58.html)

2. [ã€ŠHybrid APPåŸºç¡€ç¯‡(äºŒ) -> Nativeã€Hybridã€React Nativeã€Web Appæ–¹æ¡ˆçš„åˆ†ææ¯”è¾ƒã€‹](https://www.cnblogs.com/dailc/p/5930238.html)

#### 1.1 ä¸»æµåº”ç”¨ç±»å‹

éšç€ç°åœ¨ç§»åŠ¨äº’è”ç½‘çš„å¿«é€Ÿå‘å±•ï¼Œå¸‚é¢ä¸Šç›®å‰ä¸»æµç§»åŠ¨åº”ç”¨ç¨‹åºä¸»è¦åˆ†ä¸‰ç±»ï¼š**Web App**ã€ **Native App** å’Œ **Hybrid App**ã€‚

ä¸‰è€…å¤§è‡´å…³ç³»å¦‚ä¸‹ï¼š   

![å…³ç³»å›¾](http://images.pingan8787.com/20190623HybridApp1.png)   

#### 1.2 Web App

**Web App**ï¼Œå³**ç§»åŠ¨ç«¯ç½‘ç«™**ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯åŸºäº Web çš„åº”ç”¨ï¼ŒåŸºäº**æµè§ˆå™¨è¿è¡Œ**ï¼Œ**æ— éœ€ä¸‹è½½å®‰è£…**ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥è¯´æ˜¯è§¦å±ç‰ˆçš„ç½‘é¡µåº”ç”¨ã€‚è¿™ç±»åº”ç”¨åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªç½‘é¡µæˆ–ä¸€ç³»åˆ—ç½‘é¡µï¼Œæ—¨åœ¨åœ¨ç§»åŠ¨å±å¹•ä¸Šå·¥ä½œã€‚

**Web ç½‘ç«™**ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§ï¼š

1. **MPA**(Multi-page Application)

2. **SPA**(Single-page Application)

ä¸€èˆ¬çš„ **Web App** æ˜¯æŒ‡ **SPA** å½¢å¼å¼€å‘çš„ç½‘ç«™ã€‚  


**ä¼˜ç‚¹ï¼š**

* **å¼€å‘å’Œç»´æŠ¤æˆæœ¬ä½ï¼Œå¯ä»¥è·¨å¹³å°ï¼Œè°ƒè¯•æ–¹ä¾¿ï¼›**

å‰ç«¯äººå‘˜å¼€å‘çš„ä»£ç ï¼Œå¯åº”ç”¨äºå„å¤§ä¸»æµæµè§ˆå™¨(ç‰¹æ®Šæƒ…å†µå¯ä»¥ä»£ç è¿›è¡Œä¸‹å…¼å®¹)ï¼Œæ²¡æœ‰æ–°çš„å­¦ä¹ æˆæœ¬ï¼Œè€Œä¸”å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è°ƒè¯•ã€‚ 

* **æ›´æ–°æœ€ä¸ºå¿«é€Ÿï¼›**

ç”±äºweb appèµ„æºæ˜¯ç›´æ¥éƒ¨ç½²åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œæ‰€ä»¥åªéœ€æ›¿æ¢æœåŠ¡å™¨ç«¯æ–‡ä»¶ï¼Œç”¨æˆ·è®¿é—®æ˜¯å°±å·²ç»æ›´æ–°äº†(å½“ç„¶éœ€è¦è§£å†³ä¸€äº›ç¼“å­˜é—®é¢˜)ã€‚ 

* **æ— éœ€å®‰è£…Appï¼Œä¸ä¼šå ç”¨æ‰‹æœºå†…å­˜ï¼›**

é€šè¿‡æµè§ˆå™¨å³å¯è®¿é—®ï¼Œæ— éœ€å®‰è£…ï¼Œç”¨æˆ·ä½¿ç”¨æˆæœ¬æ›´ä½ã€‚ 

**ç¼ºç‚¹ï¼š**

* **æ€§èƒ½ä½ï¼Œç”¨æˆ·ä½“éªŒå·®ï¼›**

ç”±äºæ˜¯ç›´æ¥é€šè¿‡çš„æµè§ˆå™¨è®¿é—®ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨åŸç”Ÿçš„APIï¼Œæ“ä½œä½“éªŒä¸å¥½ã€‚ 

* **ä¾èµ–äºç½‘ç»œï¼Œé¡µé¢è®¿é—®é€Ÿåº¦æ…¢ï¼Œè€—è´¹æµé‡ï¼›**

Web Appæ¯æ¬¡è®¿é—®éƒ½å¿…é¡»ä¾èµ–ç½‘ç»œï¼Œä»æœåŠ¡ç«¯åŠ è½½èµ„æºï¼Œå½“ç½‘é€Ÿæ…¢æ—¶è®¿é—®é€Ÿåº¦å¾ˆä¸ç†æƒ³ï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨ç«¯ï¼Œå¯¹ç½‘ç«™æ€§èƒ½ä¼˜åŒ–è¦æ±‚æ¯”è¾ƒé«˜ã€‚ 

* **åŠŸèƒ½å—é™ï¼Œå¤§é‡åŠŸèƒ½æ— æ³•å®ç°ï¼›**

åªèƒ½ä½¿ç”¨ HTML5 çš„ä¸€äº›ç‰¹æ®Š API ï¼Œæ— æ³•è°ƒç”¨åŸç”Ÿ API ï¼Œæ‰€ä»¥å¾ˆå¤šåŠŸèƒ½å­˜åœ¨æ— æ³•å®ç°æƒ…å†µã€‚ 

* **ä¸´æ—¶æ€§å…¥å£ï¼Œç”¨æˆ·ç•™å­˜ç‡ä½ï¼›**

è¿™æ—¢æ˜¯å®ƒçš„ä¼˜ç‚¹ï¼Œä¹Ÿæ˜¯ç¼ºç‚¹ï¼Œä¼˜ç‚¹æ˜¯æ— éœ€å®‰è£…ï¼Œç¡®å®šæ˜¯ç”¨å®Œåæœ‰æ—¶å€™å¾ˆéš¾å†æ‰¾åˆ°ï¼Œæˆ–è€…è¯´å¾ˆéš¾ä¸“é—¨ä¸ºæŸä¸ªweb appç•™å­˜ä¸€ä¸ªå…¥å£ï¼Œå¯¼è‡´ç”¨æˆ·å¾ˆéš¾å†æ¬¡ä½¿ç”¨ã€‚ 

#### 1.3 Native App

**Native APP** æŒ‡çš„æ˜¯åŸç”Ÿç¨‹åºï¼Œéœ€è¦ç”¨æˆ·ä¸‹è½½å®‰è£…ä½¿ç”¨ï¼Œä¸€èˆ¬ä¾æ‰˜äºæ“ä½œç³»ç»Ÿï¼Œæœ‰å¾ˆå¼ºçš„äº¤äº’ï¼Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„Appï¼Œå¯æ‹“å±•æ€§å¼ºï¼Œèƒ½å‘å¸ƒåº”ç”¨å•†åº—ã€‚

ç›®å‰å¸‚é¢ä¸Šä¸»æµçš„å¹³å°æœ‰ï¼š**Android** å’Œ **iOS**ã€‚


**ä¼˜ç‚¹ï¼š**  

* ç›´æ¥ä¾æ‰˜äºæ“ä½œç³»ç»Ÿï¼Œ**ç”¨æˆ·ä½“éªŒå¥½**ï¼Œ**æ“ä½œæµç•…**ï¼Œ**æ€§èƒ½ç¨³å®š**ï¼›

* ç”¨æˆ·ç•™å­˜ç‡é«˜ï¼›  

* åŠŸèƒ½æœ€ä¸ºå¼ºå¤§ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸ç³»ç»Ÿäº¤äº’ä¸­ï¼Œå‡ ä¹æ‰€æœ‰åŠŸèƒ½éƒ½èƒ½å®ç°ï¼›

ç”±äº **Native APP** æ˜¯ç›´æ¥ä¾æ‰˜äºç³»ç»Ÿï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è°ƒç”¨å®˜æ–¹æä¾›çš„APIï¼ŒåŠŸèƒ½æœ€ä¸ºå…¨é¢(æ¯”å¦‚æœ¬åœ°èµ„æºæ“ä½œï¼Œé€šçŸ¥ï¼ŒåŠ¨ç”»ç­‰)ã€‚

**ç¼ºç‚¹ï¼š**   

* å¼€å‘å’Œç»´æŠ¤æˆæœ¬é«˜ï¼Œæ— æ³•è·¨å¹³å°ï¼Œéœ€è¦å„å¹³å°å„è‡ªç‹¬ç«‹å¼€å‘ï¼›

**Android** ä¸ŠåŸºäº **Java** å¼€å‘ï¼Œ**iOS** ä¸ŠåŸº **OC** æˆ– **Swift** å¼€å‘ï¼Œç›¸äº’ä¹‹é—´ç‹¬ç«‹ï¼Œå¿…é¡»è¦æœ‰å„è‡ªçš„å¼€å‘äººå‘˜ã€‚

* é—¨æ§›è¾ƒé«˜ï¼ŒåŸç”Ÿäººå‘˜æœ‰ä¸€å®šçš„å…¥é—¨é—¨æ§›ï¼Œäººæ‰è¾ƒå°‘ï¼›

åŸç”Ÿçš„ä¸€ä¸ªå¾ˆå¤§ç‰¹ç‚¹å°±æ˜¯ç‹¬ç«‹ï¼Œæ‰€ä»¥ä¸å¤ªå®¹æ˜“å…¥é—¨ï¼Œè€Œä¸” **Android**ï¼Œ **iOS**éƒ½éœ€è¦ç‹¬ç«‹å­¦ä¹ ã€‚

* åˆ†å‘æˆæœ¬é«˜ï¼Œæ›´æ–°ç¼“æ…¢ï¼Œç‰¹åˆ«æ˜¯å‘å¸ƒåº”ç”¨å•†åº—åï¼Œéœ€è¦ç­‰åˆ°å®¡æ ¸å‘¨æœŸï¼›

åŸç”Ÿåº”ç”¨æ›´æ–°æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œ **Android**ä¸­è¿˜èƒ½ç›´æ¥ä¸‹è½½æ•´åŒ…APKè¿›è¡Œæ›´æ–°ï¼Œä½†æ˜¯ **iOS**ä¸­ï¼Œå¦‚æœæ˜¯å‘å¸ƒ **AppStore** ï¼Œå¿…é¡»é€šè¿‡ **AppStore**åœ°å€æ›´æ–°ï¼Œè€Œæ¯æ¬¡æ›´æ–°éƒ½éœ€è¦å®¡æ ¸ï¼Œæ‰€ä»¥æ— æ³•è¾¾åˆ°åŠæ—¶æ›´æ–°ã€‚

#### 1.4 Hybrid App

**Hybrid App** æŒ‡çš„æ˜¯**æ··åˆå¼€å‘**ï¼Œä¹Ÿå°±æ˜¯åŠåŸç”ŸåŠ Web çš„å¼€å‘æ¨¡å¼ï¼Œæœ‰è·¨å¹³å°æ•ˆæœï¼Œå½“ç„¶äº†ï¼Œå®è´¨æœ€ç»ˆå‘å¸ƒçš„ä»ç„¶æ˜¯ç‹¬ç«‹çš„åŸç”ŸAPP(å„ç§çš„å¹³å°æœ‰å„ç§çš„SDK)ã€‚  

**ä¼˜ç‚¹ï¼š**

* **å­¦ä¹ å’Œå¼€å‘æˆæœ¬è¾ƒä½ï¼Œå¯ä»¥è·¨å¹³å°ï¼Œè°ƒè¯•æ–¹ä¾¿**ï¼›  

Hybrid å¼€å‘æ¨¡å¼ä¸‹ï¼Œç”±åŸç”Ÿæä¾›ç»Ÿä¸€çš„ API ç»™ JS è°ƒç”¨ï¼Œå®é™…çš„ä¸»è¦é€»è¾‘ç”± HTML å’Œ JS å®Œæˆï¼Œæœ€ç»ˆæ”¾åœ¨ webview ä¸­æ˜¾ç¤ºï¼Œè¿™æ ·åªéœ€è¦å†™ä¸€å¥—ä»£ç å³å¯ï¼Œè¾¾åˆ°è·¨å¹³å°æ•ˆæœï¼Œå¦å¤–ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è°ƒè¯•ï¼Œå¾ˆæ–¹ä¾¿ã€‚  

ä¸€èˆ¬ Hybrid ä¸­çš„è·¨å¹³å°æœ€å°‘å¯ä»¥è·¨ä¸‰ä¸ªå¹³å°: Android App ï¼ŒiOS App ï¼Œæ™®é€š webkit æµè§ˆå™¨ã€‚ 

éœ€è¦å‰ç«¯äººå‘˜å…³æ³¨ä¸€äº›åŸç”Ÿæä¾›çš„APIï¼Œå…·ä½“çš„å®ç°æ— éœ€å…³å¿ƒï¼Œæ²¡æœ‰æ–°çš„å­¦ä¹ å†…å®¹ã€‚  

* **ç»´æŠ¤æˆæœ¬ä½**ï¼ŒåŠŸèƒ½å¯å¤ç”¨ï¼Œå¹¶ä¸”æ›´å®¹æ˜“æ›´æ–°ï¼›  

è™½ç„¶æ²¡æœ‰ web app æ›´æ–°é‚£ä¹ˆå¿«é€Ÿï¼Œä½†æ˜¯ Hybrid ä¸­ä¹Ÿå¯ä»¥é€šè¿‡åŸç”Ÿæä¾› api ï¼Œè¿›è¡Œèµ„æºä¸»åŠ¨ä¸‹è½½ï¼Œè¾¾åˆ°åªæ›´æ–°èµ„æºæ–‡ä»¶ï¼Œä¸æ›´æ–° apk(ipa) çš„æ•ˆæœã€‚  


* åŠŸèƒ½æ›´åŠ å®Œå–„ï¼Œæ€§èƒ½å’Œä½“éªŒè¦æ¯”èµ· web app å¥½å¤ªå¤šï¼›  

å› ä¸ºå¯ä»¥è°ƒç”¨åŸç”Ÿapiï¼Œæ‰€ä»¥å¾ˆå¤šåŠŸèƒ½åªè¦åŸç”Ÿæä¾›å‡ºå°±å¯ä»¥å®ç°ï¼Œå¦å¤–æ€§èƒ½ä¹Ÿæ¯”è¾ƒæ¥è¿‘åŸç”Ÿã€‚  

* éƒ¨åˆ†æ€§èƒ½è¦æ±‚çš„é¡µé¢å¯ç”¨åŸç”Ÿå®ç°ï¼›  

è¿™ç§æ¨¡å¼æ˜¯åŸç”Ÿæ··åˆ web ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥å°†äº¤äº’å¼ºï¼Œæ€§èƒ½è¦æ±‚é«˜çš„é¡µé¢ç”¨åŸç”Ÿå†™ï¼Œç„¶åä¸€äº›å…¶å®ƒé¡µé¢ç”¨ JS å†™ï¼ŒåµŒå…¥ webview ä¸­ï¼Œè¾¾åˆ°æœ€ä½³ä½“éªŒã€‚  

**ç¼ºç‚¹ï¼š**

* ç›¸æ¯”åŸç”Ÿï¼Œæ€§èƒ½ä»ç„¶æœ‰è¾ƒå¤§æŸè€—ï¼›

è¿™ç§æ¨¡å¼å—é™äº webview çš„æ€§èƒ½ï¼Œç›¸æ¯”åŸç”Ÿè€Œè¨€æœ‰ä¸å°‘æŸè€—ï¼Œä½“éªŒæ— æ³•å’ŒåŸç”Ÿç›¸æ¯”ã€‚

* ä¸é€‚ç”¨äºäº¤äº’æ€§è¾ƒå¼ºçš„appï¼›

è¿™ç§æ¨¡å¼çš„ä¸»è¦é€‚ç”¨ï¼šä¸€äº›æ–°é—»é˜…è¯»ç±»ï¼Œä¿¡æ¯å±•ç¤ºç±»çš„ app ï¼Œä¸é€‚ç”¨äºä¸€äº›äº¤äº’è¾ƒå¼ºæˆ–è€…æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„ app (æ¯”å¦‚åŠ¨ç”»è¾ƒå¤šå°±ä¸é€‚åˆ)ã€‚


#### 1.5 ä¸‰è€…åŒºåˆ«

**ä¸‰è€…ä½¿ç”¨åœºæ™¯å¯¹æ¯”ï¼š**

![å¯¹æ¯”å›¾](http://images.pingan8787.com/20190623HybridApp7.png)

**ä¸‰è€…æŠ€æœ¯ç‰¹å¾å¯¹æ¯”ï¼š**

![å¯¹æ¯”å›¾](http://images.pingan8787.com/20190623HybridApp2.png)

**å¦å¤–å¢åŠ  ReactNative ä¸€èµ·æ”¾å…¥ä½œå¯¹æ¯”ã€‚**

||NativeApp|WebApp|HybridApp|ReactNativeApp|
|:---|:---|:----|:---|---|
|åŸç”ŸåŠŸèƒ½ä½“éªŒ|ä¼˜ç§€|å·®|è‰¯å¥½|æ¥è¿‘ä¼˜ç§€|
|æ¸²æŸ“æ€§èƒ½|éå¸¸å¿«|æ…¢|æ¥è¿‘å¿«|å¿«|
|æ˜¯å¦æ”¯æŒè®¾å¤‡åº•å±‚è®¿é—®|æ”¯æŒ|ä¸æ”¯æŒ|æ”¯æŒ|æ”¯æŒ|
|ç½‘ç»œè¦æ±‚|æ”¯æŒç¦»çº¿|ä¾èµ–ç½‘ç»œ|æ”¯æŒç¦»çº¿(èµ„æºå­˜æœ¬åœ°æƒ…å†µ)|æ”¯æŒç¦»çº¿|
|æ›´æ–°å¤æ‚åº¦|é«˜(å‡ ä¹æ€»æ˜¯é€šè¿‡åº”ç”¨å•†åº—æ›´æ–°)|ä½(æœåŠ¡å™¨ç«¯ç›´æ¥æ›´æ–°)|è¾ƒä½(å¯ä»¥è¿›è¡Œèµ„æºåŒ…æ›´æ–°)|è¾ƒä½(å¯ä»¥è¿›è¡Œèµ„æºåŒ…æ›´æ–°)|
|ç¼–ç¨‹è¯­è¨€|Android(Java)ï¼ŒiOS(OC/Swift)|js+html+css3|js+html+css3|ä¸»è¦ä½¿ç”¨JSç¼–å†™ï¼Œè¯­æ³•è§„åˆ™JSX|
|ç¤¾åŒºèµ„æº|ä¸°å¯Œ(Androidï¼ŒiOSå•ç‹¬å­¦ä¹ )|ä¸°å¯Œ(å¤§é‡å‰ç«¯èµ„æº)|æœ‰å±€é™(ä¸åŒçš„Hybridç›¸äº’ç‹¬ç«‹)|ä¸°å¯Œ(ç»Ÿä¸€çš„æ´»è·ƒç¤¾åŒº)|
|ä¸Šæ‰‹éš¾åº¦|éš¾(ä¸åŒå¹³å°éœ€è¦å•ç‹¬å­¦ä¹ )|ç®€å•(å†™ä¸€æ¬¡ï¼Œæ”¯æŒä¸åŒå¹³å°è®¿é—®)|ç®€å•(å†™ä¸€æ¬¡ï¼Œè¿è¡Œä»»ä½•å¹³å°)|ä¸­ç­‰(å­¦ä¹ ä¸€æ¬¡ï¼Œå†™ä»»ä½•å¹³å°)|
|å¼€å‘å‘¨æœŸ|é•¿|çŸ­|è¾ƒçŸ­|ä¸­ç­‰|
|å¼€å‘æˆæœ¬|æ˜‚è´µ|ä¾¿å®œ|è¾ƒä¸ºä¾¿å®œ|ä¸­ç­‰|
|è·¨å¹³å°|ä¸è·¨å¹³å°|æ‰€æœ‰H5æµè§ˆå™¨|Androidï¼ŒiOSï¼Œh5æµè§ˆå™¨|Androidï¼ŒiOS|
|APPå‘å¸ƒ|AppStore|WebæœåŠ¡å™¨|AppStore|AppStore|
   
#### 1.6 ä¸‰è€…å¦‚ä½•é€‰æ‹©

è¿™é‡Œç®€å•ä»‹ç»å‡ ç§æƒ…å†µï¼Œå…·ä½“è¿˜æ˜¯è¦ä»¥å®é™…é¡¹ç›®æŠ€æœ¯è¯„ä¼°ç»“æœä¸ºä¸»ã€‚  

* é€‰æ‹©çº¯ Native App æ¨¡å¼çš„æƒ…å†µï¼š

**æ€§èƒ½è¦æ±‚æé«˜ï¼Œä½“éªŒè¦æ±‚æå¥½ï¼Œä¸è¿½æ±‚å¼€å‘æ•ˆç‡**ã€‚

* é€‰æ‹© Web App æ¨¡å¼çš„æƒ…å†µï¼š

ä¸è¿½æ±‚ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ï¼Œå¯¹ç¦»çº¿è®¿é—®æ²¡è¦æ±‚ï¼Œæ­£å¸¸æ¥è¯´ï¼Œå¦‚æœè¿½æ±‚æ€§èƒ½å’Œä½“éªŒï¼Œéƒ½ä¸ä¼šé€‰ç”¨web appã€‚

* é€‰æ‹© Hybrid App æ¨¡å¼çš„æƒ…å†µ

**å¤§éƒ¨åˆ†æƒ…å†µä¸‹çš„Appéƒ½æ¨èé‡‡ç”¨è¿™ç§æ¨¡å¼**ï¼Œè¿™ç§æ¨¡å¼å¯ä»¥ç”¨åŸç”Ÿæ¥å®ç°è¦æ±‚é«˜çš„ç•Œé¢ï¼Œå¯¹äºä¸€äº›æ¯”è¾ƒé€šç”¨å‹ï¼Œå±•ç¤ºå‹çš„é¡µé¢å®Œå…¨å¯ä»¥ç”¨webæ¥å®ç°ï¼Œè¾¾åˆ°è·¨å¹³å°æ•ˆæœï¼Œ**æå‡æ•ˆç‡**ã€‚ä¸€èˆ¬å¥½ä¸€ç‚¹çš„Hybridæ–¹æ¡ˆï¼Œéƒ½ä¼š**æŠŠèµ„æºæ”¾åœ¨æœ¬åœ°**çš„ï¼Œå¯ä»¥**å‡å°‘ç½‘ç»œæµé‡æ¶ˆè€—**ã€‚

* é€‰æ‹©React Native Appæ¨¡å¼çš„æƒ…å†µ

è¿½æ±‚æ€§èƒ½ï¼Œä½“éªŒï¼ŒåŒæ—¶è¿½æ±‚å¼€å‘æ•ˆç‡ï¼Œè€Œä¸”æœ‰ä¸€å®šçš„æŠ€æœ¯èµ„æœ¬ï¼Œèˆå¾—å‰æœŸæŠ•å…¥ã€‚

React Nativeè¿™ç§æ¨¡å¼å­¦ä¹ æˆæœ¬è¾ƒé«˜ï¼Œæ‰€ä»¥éœ€è¦å‰æœŸæŠ•å…¥ä¸å°‘æ—¶é—´æ‰èƒ½è¾¾åˆ°è¾ƒå¥½æ°´å¹³ï¼Œä½†æ˜¯æœ‰äº†ä¸€å®šæ°´å‡†åï¼Œå¼€å‘èµ·æ¥å®ƒçš„ä¼˜åŠ¿å°±ä½“ç°å‡ºæ¥äº†ï¼Œæ€§èƒ½ä¸é€Šè‰²åŸç”Ÿï¼Œè€Œä¸”å¼€å‘é€Ÿåº¦ä¹Ÿå¾ˆå¿«

### äºŒã€ä»€ä¹ˆæ˜¯ Cordovaï¼Œå®ƒçš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆ

å‚è€ƒæ–‡ç« ï¼š [ã€Šæµ…è°ˆCordovaæ¡†æ¶ã€‹](https://blog.csdn.net/weixin_37730482/article/details/73920722)

#### 2.1 Cordova ç®€ä»‹ 

Cordova æ˜¯ä¸€ä¸ªç”¨åŸºäº HTMLã€CSS å’Œ JavaScript çš„ï¼Œ**ç”¨äºåˆ›å»ºè·¨å¹³å°ç§»åŠ¨åº”ç”¨ç¨‹åºçš„å¿«é€Ÿå¼€å‘å¹³å°**ã€‚å®ƒä½¿å¼€å‘è€…èƒ½å¤Ÿåˆ©ç”¨iPhoneã€Androidã€Palmã€Symbianã€WP7ã€Badaå’ŒBlackberryç­‰æ™ºèƒ½æ‰‹æœºçš„æ ¸å¿ƒåŠŸèƒ½â€”â€”åŒ…æ‹¬åœ°ç†å®šä½ã€åŠ é€Ÿå™¨ã€è”ç³»äººã€å£°éŸ³å’ŒæŒ¯åŠ¨ç­‰ï¼Œæ­¤å¤– Cordova æ‹¥æœ‰ä¸°å¯Œçš„æ’ä»¶ï¼Œå¯ä»¥è°ƒç”¨ã€‚

ä¹Ÿå¯ä»¥ç”¨æ¥å¼€å‘**åŸç”Ÿå’ŒWebViewç»„ä»¶ä¹‹é—´çš„æ’ä»¶æ¥å£**ã€‚

**æ¥æºï¼š**  
Cordova æ˜¯ PhoneGap è´¡çŒ®ç»™ Apache åçš„å¼€æºé¡¹ç›®ï¼Œæ˜¯ä» PhoneGap ä¸­æŠ½å‡ºçš„æ ¸å¿ƒä»£ç ï¼Œæ˜¯é©±åŠ¨ PhoneGap çš„æ ¸å¿ƒå¼•æ“ã€‚å¯ä»¥æŠŠå®ƒä»¬çš„å…³ç³»æƒ³è±¡æˆç±»ä¼¼äº Webkit å’Œ Google Chrome çš„å…³ç³»ã€‚

#### 2.2 Cordova æ¶æ„å›¾ 

![Cordovaæ¶æ„å›¾](http://images.pingan8787.com/20190623HybridApp3.jpg)  

**æ¶æ„å›¾ä»‹ç»ï¼š**   

* **Web App**

ç”¨äºå­˜æ”¾æˆ‘ä»¬ç¨‹åºçš„ä»£ç ï¼ŒåŒ…æ‹¬ä¸šåŠ¡é€»è¾‘ï¼Œè¿˜æœ‰ä¸€äº›è¿è¡Œéœ€è¦çš„èµ„æºï¼ˆå¦‚ï¼šCSSï¼ŒJavaScriptï¼Œå›¾ç‰‡ï¼Œåª’ä½“æ–‡ä»¶ç­‰ï¼‰ã€‚
åº”ç”¨çš„å®ç°æ˜¯é€šè¿‡ web é¡µé¢ï¼Œé»˜è®¤çš„æœ¬åœ°æ–‡ä»¶åç§°æ˜¯ `index.html` ï¼Œåº”ç”¨æ‰§è¡Œåœ¨åŸç”Ÿåº”ç”¨åŒ…è£…çš„ WebView ä¸­ï¼Œè¿™ä¸ªåŸç”Ÿåº”ç”¨æ˜¯ä½ åˆ†å‘åˆ°åº”ç”¨å•†åº—ä¸­çš„ã€‚

* **WebView**

Cordova ç”¨çš„ WebView å¯ä»¥ç»™åº”ç”¨æä¾›å®Œæ•´ç”¨æˆ·è®¿é—®ç•Œé¢ï¼Œä½¿å¾—åº”ç”¨æ··åˆäº† Webview å’ŒåŸç”Ÿçš„åº”ç”¨ç»„ä»¶ã€‚

* **Cordova Plugins**

æ’ä»¶æ˜¯ Cordova ç”Ÿæ€ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å®ƒ**æä¾›äº† Cordova å’ŒåŸç”Ÿç»„ä»¶ç›¸äº’é€šä¿¡çš„æ¥å£**ï¼Œå¹¶ç»‘å®šåˆ°äº†æ ‡å‡†çš„è®¾å¤‡APIä¸Šï¼Œè¿™ä½¿ä½ èƒ½å¤Ÿ**é€šè¿‡ JavaScript è°ƒç”¨åŸç”Ÿä»£ç **ã€‚


#### 2.3 ä¼˜ç¼ºç‚¹

**ä¼˜ç‚¹ï¼š**  

* è·¨å¹³å°ï¼Œå¼€å‘ç®€å•ï¼Œå­¦ä¹ æˆæœ¬ä½ï¼›
* æ¡†æ¶å¤šï¼Œæ’ä»¶å¤šï¼Œå¯è‡ªå®šä¹‰æ’ä»¶ï¼›
* å‘å±•æœ€æ—©ï¼Œç¤¾åŒºèµ„æºä¸°å¯Œï¼›

**ç¼ºç‚¹ï¼š**  

* WebViewæ€§èƒ½ä½ä¸‹æ—¶ï¼Œç”¨æˆ·ä½“éªŒå·®ï¼Œååº”æ…¢ï¼›
* ä¸­æ–‡æ–‡æ¡£èµ„æºå°‘ï¼›
* è°ƒè¯•ä¸æ–¹ä¾¿ï¼Œæ—¢ä¸åƒåŸç”Ÿé‚£ä¹ˆå¥½è°ƒè¯•ï¼Œä¹Ÿä¸åƒçº¯webé‚£ç§è°ƒè¯•ï¼›


### ä¸‰ã€Cordova æ’ä»¶çš„åŸç†æ˜¯ä»€ä¹ˆ

Cordova æ’ä»¶å°±æ˜¯ä¸€äº›é™„åŠ ä»£ç ç”¨æ¥æä¾›åŸç”Ÿç»„ä»¶çš„ JavaScript æ¥å£ï¼Œå®ƒå…è®¸ä½ çš„ App å¯ä»¥ä½¿ç”¨åŸç”Ÿè®¾å¤‡çš„èƒ½åŠ›ï¼Œè¶…è¶Šäº†çº¯ç²¹çš„ Web Appã€‚

**Cordova åœ¨ iOS ä¸Šçš„å®ç°åŸç†ï¼š**
![cordova](http://images.pingan8787.com/20190623HybridApp6.png)

#### 3.1 å·¥ä½œæµç¨‹

1. Cordova å‘èµ·å¯¹åŸç”Ÿçš„è¯·æ±‚ï¼š   

```js
cordova.exec(successCallback, failCallback, service, action, actionArgs); 
// successCallback: æˆåŠŸå›è°ƒæ–¹æ³•
// failCallback: å¤±è´¥å›è°ƒæ–¹æ³•
// server: æ‰€è¦è¯·æ±‚çš„æœåŠ¡åå­—
// action: æ‰€è¦è¯·æ±‚çš„æœåŠ¡å…·ä½“æ“ä½œ
// actionArgs: è¯·æ±‚æ“ä½œæ‰€å¸¦çš„å‚æ•°
```

2. è¿™äº”ä¸ªå‚æ•°å¹¶ä¸æ˜¯ç›´æ¥ä¼ ç»™åŸç”Ÿï¼ŒCordova JS ç«¯ä¼šåšä»¥ä¸‹å¤„ç†ï¼š

    * ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆä¸€ä¸ªå”¯ä¸€æ ‡è¯†( `callbackId` )ï¼Œå¹¶ä¼ ç»™åŸç”Ÿç«¯ï¼ŒåŸç”Ÿç«¯å¤„ç†å®Œåï¼Œä¼šæŠŠ `callbackId` è¿åŒå¤„ç†ç»“æœä¸€èµ·è¿”å›ç»™ JS ç«¯ï¼›
    * ä»¥ `callbackId` ä¸º `key`ï¼Œ`{success:successCallback, fail:failCallback}` ä¸º `value`ï¼ŒæŠŠè¿™ä¸ªé”®å€¼å¯¹ä¿å­˜åœ¨ JS ç«¯çš„å­—å…¸é‡Œï¼Œ`successCallback` ä¸ `failCallback` è¿™ä¸¤ä¸ªå‚æ•°ä¸éœ€è¦ä¼ ç»™åŸç”Ÿï¼ŒåŸç”Ÿè¿”å›ç»“æœæ—¶å¸¦ä¸Š` callbackId`ï¼ŒJS ç«¯å°±å¯ä»¥æ ¹æ® `callbackId` æ‰¾åˆ°å›è°ƒæ–¹æ³•ï¼›
    * æ¯æ¬¡ JS è¯·æ±‚ï¼Œæœ€åå‘åˆ°åŸç”Ÿçš„æ•°æ®åŒ…æ‹¬ï¼š`callbackId`, `service`, `action`, `actionArgs`ï¼›

![iOS](http://images.pingan8787.com/20190623HybridApp12.png)

3. åŸç”Ÿä»£ç æ‹¿åˆ° `callbackId`ã€`service`ã€`action` åŠ `actionArgs` åï¼Œä¼šåšä»¥ä¸‹å¤„ç†ï¼š

    * æ ¹æ® `service` å‚æ•°æ‰¾åˆ°å¯¹åº”æ’ä»¶ç±»ï¼›
    * æ ¹æ® `action` å‚æ•°æ‰¾åˆ°æ’ä»¶ç±»ä¸­å¯¹åº”çš„å¤„ç†æ–¹æ³•ï¼Œå¹¶æŠŠ `actionArgs` ä½œä¸ºå¤„ç†æ–¹æ³•è¯·æ±‚å‚æ•°çš„ä¸€éƒ¨åˆ†ä¼ ç»™å¤„ç†æ–¹æ³•ï¼›
    * å¤„ç†å®Œæˆåï¼ŒæŠŠå¤„ç†ç»“æœåŠ `callbackId` è¿”å›ç»™ JS ç«¯ï¼ŒJS ç«¯æ”¶åˆ°åä¼šæ ¹æ® `callbackId` æ‰¾åˆ°å›è°ƒæ–¹æ³•ï¼Œå¹¶æŠŠå¤„ç†ç»“æœä¼ ç»™å›è°ƒæ–¹æ³•ï¼›

![iOS](http://images.pingan8787.com/20190623HybridApp13.png)

4. JS ç«¯æ ¹æ® `callbackId` å›è°ƒ `cordova.js`


```js
// æ ¹æ® callbackId åŠæ˜¯å¦æˆåŠŸæ ‡è¯†ï¼Œæ‰¾åˆ°å›è°ƒæ–¹æ³•ï¼Œå¹¶æŠŠå¤„ç†ç»“æœä¼ ç»™å›è°ƒæ–¹æ³•
callbackFromNative: function(callbackId, success, status, args, keepCallback) {
    var callback = cordova.callbacks[callbackId];
    if (callback) {
        if (success && status == cordova.callbackStatus.OK) {
            callback.success && callback.success.apply(null, args);
        } else if (!success) {
            callback.fail && callback.fail.apply(null, args);
        }

        // Clear callback if not expecting any more results
        if (!keepCallback) {
            delete cordova.callbacks[callbackId];
        }
    }
}
```

### å››ã€ä»€ä¹ˆæ˜¯ JS Bridgeï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆ

å‚è€ƒæ–‡ç« ï¼š[ã€ŠJSBridgeçš„åŸç†ã€‹](https://juejin.im/post/5abca877f265da238155b6bc)

#### 4.1 JS Bridge ä»‹ç»

JSBridge ç®€å•æ¥è®²ï¼Œä¸»è¦æ˜¯ **ç»™ JavaScript æä¾›è°ƒç”¨ Native åŠŸèƒ½çš„æ¥å£**ï¼Œè®©æ··åˆå¼€å‘ä¸­çš„**å‰ç«¯éƒ¨åˆ†**å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨åœ°å€ä½ç½®ã€æ‘„åƒå¤´ç”šè‡³æ”¯ä»˜ç­‰ Native åŠŸèƒ½ã€‚

JSBridge å°±åƒå…¶åç§°ä¸­çš„ **â€œBridgeâ€** çš„æ„ä¹‰ä¸€æ ·ï¼Œ**æ˜¯ Native å’Œé Native ä¹‹é—´çš„æ¡¥æ¢**ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯ **æ„å»º Native å’Œé Native é—´æ¶ˆæ¯é€šä¿¡çš„é€šé“ï¼Œè€Œä¸”æ˜¯ åŒå‘é€šä¿¡çš„é€šé“**ã€‚

JSBridge ä¹Ÿè¢«ç§°ä¸º Hybrid app æŠ€æœ¯ã€‚

![brige](http://images.pingan8787.com/20190623HybridApp4.png)

æ‰€è°“ **åŒå‘é€šä¿¡çš„é€šé“**:

* JS å‘ Native å‘é€æ¶ˆæ¯ : 

è°ƒç”¨ç›¸å…³åŠŸèƒ½ã€é€šçŸ¥ Native å½“å‰ JS çš„ç›¸å…³çŠ¶æ€ç­‰ã€‚

* Native å‘ JS å‘é€æ¶ˆæ¯ : 

å›æº¯è°ƒç”¨ç»“æœã€æ¶ˆæ¯æ¨é€ã€é€šçŸ¥ JS å½“å‰ Native çš„çŠ¶æ€ç­‰ã€‚

#### 4.2. JS Bridge å®ç°åŸç†

å‚è€ƒæ–‡ç« ï¼š[ã€ŠHybrid APPåŸºç¡€ç¯‡(å››)->JSBridgeçš„åŸç†ã€‹](https://www.cnblogs.com/dailc/p/5931324.html)

**Android å’Œ iOS çš„ JSBridge å®ç°æ–¹å¼ï¼š**  

![brigeåŸç†](http://images.pingan8787.com/20190623HybridApp9.jpeg)

##### 4.2.1 åŸºæœ¬æµç¨‹

![brigeåŸç†](http://images.pingan8787.com/20190623HybridApp5.png)

* H5 é¡µé¢é€šè¿‡æŸç§æ–¹å¼è§¦å‘ä¸€ä¸ª `url scheme `ï¼›  
* Native æ•è·åˆ° `url scheme`ï¼Œå¹¶è¿›è¡Œåˆ†æå’Œå¤„ç†ï¼›  
* Native è°ƒç”¨ H5 çš„ JSBridge å¯¹è±¡ä¼ é€’å›è°ƒï¼›  

åŸç”Ÿçš„ WebView/UIWebView æ§ä»¶å·²ç»èƒ½å¤Ÿå’Œ JS å®ç°æ•°æ®é€šä¿¡äº†ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦ JSBridgeå‘¢ï¼Ÿ

å…¶å®ä½¿ç”¨JSBridgeæœ‰å¾ˆå¤šæ–¹é¢çš„è€ƒè™‘ï¼š

* Android4.2ä»¥ä¸‹ï¼Œ`addJavascriptInterface` æ–¹å¼æœ‰å®‰å…¨æ¼æ‰ã€‚
* iOS7ä»¥ä¸‹ï¼ŒJS æ— æ³•è°ƒç”¨ Nativeã€‚
* `url scheme` äº¤äº’æ–¹å¼æ˜¯ä¸€å¥—ç°æœ‰çš„æˆç†Ÿæ–¹æ¡ˆï¼Œå¯ä»¥å®Œç¾å…¼å®¹å„ç§ç‰ˆæœ¬ï¼Œå¯¹ä»¥å‰è€ç‰ˆæœ¬æŠ€æœ¯çš„å…¼å®¹ã€‚

##### 4.2.1 å®ç°æµç¨‹(Android ä¸ºä¾‹)

![brigeåŸç†](http://images.pingan8787.com/20190623HybridApp10.png)

1. æ‹Ÿå®šåè®®ï¼Œå‚è€ƒ http åˆ¶å®šçš„åè®®ä¸ºï¼š`jsbridge://className:port/methodName?jsonObj`ï¼›   

```
className   // Androidç«¯å®ç°æš´éœ²ç»™å‰ç«¯çš„ç±»å
port        // Androidè¿”å›ç»“æœç»™å‰ç«¯çš„ç«¯å£
methodName  // å‰ç«¯éœ€è¦è°ƒç”¨çš„å‡½æ•°
jsonObj     // å‰ç«¯ç»™Androidä¼ é€’çš„å‚æ•°
```

2. æ–°å»º HTML æ–‡ä»¶å‘½åä¸º `index.html`, ç¼–å†™ä¸€ä¸ª `button` ç»‘å®š `click` äº‹ä»¶ï¼›

```html
<button onclick="JSBridge.call(
    'bridge',
    'showToast',
    {'msg':'Hello JSBridge'},
    function(res){
        alert(JSON.stringify(res))
    }
)">
    æµ‹è¯•showToast 
</button>
```

3. æ–°å»º JS æ–‡ä»¶å‘½åä¸º `JSBridge.js`ï¼Œ ç¬¬2æ­¥ä¸­çš„ `JSBridge.call` å³ä¸ºè°ƒç”¨ `JSBridge.js `ä¸­çš„ `call` æ–¹æ³•ï¼Œåé¢å¸¦äº†å››ä¸ªå‚æ•°ï¼›   

```js
call: function (obj, method, params, callback) {
    console.log(obj+" "+method+" "+params+" "+callback);
    var port = Util.getPort();
    console.log(port);
    this.callbacks[port] = callback;
    var uri=Util.getUri(obj,method,params,port);
    console.log(uri);
    window.prompt(uri, "");
},
```

`JSBridge.js` ä¸­çš„ `call` æ–¹æ³•ï¼Œæœ€åè°ƒç”¨äº†` window.prompt` æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è§¦å‘ Android ç«¯ `webChromeClient `çš„å›è°ƒå‡½æ•°ç”¨çš„ã€‚

4. `window.prompt` è§¦å‘äº† `WebChromeClient`ï¼ˆè¿™ä¸ªéœ€è¦ä½¿ç”¨å‡½æ•°`WebView.setWebChromeClient`( `new WebChromeClietn()` )è¿›è¡Œè®¾å®šï¼‰ï¼›

ç±»ä¸­çš„å¦‚ä¸‹å›è°ƒ `onJsPrompt`ã€‚è¿™æ—¶å°±å®Œæˆäº†å‰ç«¯ä¸ Androidç«¯ çš„é€šä¿¡äº†ï¼Œå› ä¸ºå‰ç«¯çš„ä¿¡æ¯éƒ½é¡ºåˆ©é€šè¿‡è¿™ä¸ªå‡½æ•°ä¼ é€’ç»™Androidäº†ã€‚

```java
@Override
public boolean onJsPrompt(WebView view, String url, String message, String defaultValue, JsPromptResult result) {
    result.confirm(JSBridge.callJava(view,message));
    return true;
}
```

5. Android ä¸­ä¼šå®šä¹‰ä¸€ä¸ªç±» `JSBridge.java` æ¥ç®¡ç†æš´éœ²ç»™å‰ç«¯ä½¿ç”¨çš„å‡½æ•°ï¼›

è¿™ä¸ªç±»æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š

* æš´éœ²ç»™å‰ç«¯çš„å‡½æ•°çš„åŠ¨æ€æ³¨å†ŒåŠŸèƒ½ã€‚
* è§£æå‰ç«¯ä¿¡æ¯ï¼Œè°ƒç”¨äº† Android ç«¯å¯¹åº”çš„å‡½æ•°ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­æ˜¯ï¼š`showToast` å‡½æ•°ã€‚

è§£æå‰ç«¯çš„ä¿¡æ¯ï¼Œè·å–å‰ç«¯è°ƒç”¨çš„å‡½æ•°åï¼š

```java
Uri uri = Uri.parse(uriString);
className = uri.getHost();
param = uri.getQuery();
port = uri.getPort() + "";
String path = uri.getPath();
HashMap< String, Method> methodHashMap = exposedMethod.get(className);
Method method = methodHashMap.get(methodName);
```
é€šè¿‡è·å–çš„å‡½æ•°åï¼Œè¿™é‡Œæ˜¯ `showToast `ï¼Œè°ƒç”¨ Android ç«¯çš„ `showToast `å‡½æ•°ã€‚   

```java
method.invoke(null,webView,new JSONObject(param),new Callback(webView,port));
```

6. å®šä¹‰ç±» `BridgeImpl.java` æ¥å…·ä½“çš„å®ç°æš´éœ²ç»™å‰ç«¯çš„æ‰€æœ‰å‡½æ•°ã€‚è¿™é‡Œçš„ `showToast `å‡½æ•°å¦‚ä¸‹:

```js
public static void showToast(WebView webView, JSONObject param, final JSBridge.Callback callback){
    String message = param.optString("msg");
    Toast.makeText(webView.getContext(),message,Toast.LENGTH_LONG).show();
    if(null != callback){
        try {
            JSONObject object = new JSONObject();
            object.put("key","value");
            object.put("key1","vaule1");
            callback.apply(getJSONObject(0,"ok",object));
        }catch (Exception e){
            e.printStackTrace();
        }
    }
}
```

### äº”ã€è¯·åˆ—ä¸¾ Android ä¸ iOS å¹³å°ä¸‹ JS Bridge çš„å®ç°æ–¹å¼

> è¿™è¾¹ä»£ç æ¯”è¾ƒå¤šï¼Œæˆ‘ä½¿ç”¨å›¾ç‰‡æ¥å±•ç¤ºï¼Œå¤§å®¶å¯ä»¥æ”¾å¤§æ¥æŸ¥çœ‹ã€‚   

#### 5.1 Android å®ç°æ–¹å¼

##### 5.1.1 Android è°ƒç”¨ JS çš„ 2 ç§æ–¹å¼   

1. **é€šè¿‡** `WebView` **çš„** `loadUrl()`:   

JS ä»£ç è°ƒç”¨ä¸€å®šè¦åœ¨ `onPageFinished()` å›è°ƒä¹‹åæ‰èƒ½è°ƒç”¨ï¼Œå¦åˆ™ä¸ä¼šè°ƒç”¨ã€‚    

**Web ç«¯ä»£ç ï¼š**   
```html
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>å‰ç«¯ä»£ç </title>
        <script>
        // Androidéœ€è¦è°ƒç”¨çš„æ–¹æ³•
        function callJS(){
            alert("Androidè°ƒç”¨äº†JSçš„callJSæ–¹æ³•");
        }
    </script>
   </head>
</html>
```

**Android ç«¯ä»£ç ï¼š**   

![Android](http://images.pingan8787.com/20190623HybridApp11.png)


2. **é€šè¿‡** `WebView` **çš„**  `evaluateJavascript()`ï¼š  

```js
// åªéœ€è¦å°†ç¬¬ä¸€ç§æ–¹æ³•çš„loadUrl()æ¢æˆä¸‹é¢è¯¥æ–¹æ³•å³å¯
mWebView.evaluateJavascript(
    "javascript:callJS()", 
    new ValueCallback<String>() {
        @Override
        public void onReceiveValue(String value) {
            //æ­¤å¤„ä¸º js è¿”å›çš„ç»“æœ
        }
    });
}
```


##### 5.1.2 JS è°ƒç”¨ Android çš„ 3 ç§æ–¹å¼ 

1. **é€šè¿‡ `WebView` çš„ `addJavascriptInterface()` è¿›è¡Œå¯¹è±¡æ˜ å°„**:   

**Android æ˜ å°„ï¼š**   
```java
// ç»§æ‰¿è‡ªObjectç±»
public class AndroidtoJs extends Object {
    // å®šä¹‰JSéœ€è¦è°ƒç”¨çš„æ–¹æ³•
    // è¢«JSè°ƒç”¨çš„æ–¹æ³•å¿…é¡»åŠ å…¥@JavascriptInterfaceæ³¨è§£
    @JavascriptInterface
    public void hello(String msg) {
        System.out.println("JSè°ƒç”¨äº†Androidçš„helloæ–¹æ³•");
    }
}
```

**Webï¼š**   

```js
<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <title>å‰ç«¯ä»£ç </title>  
      <script>
         function callAndroid(){
        // ç”±äºå¯¹è±¡æ˜ å°„ï¼Œæ‰€ä»¥è°ƒç”¨testå¯¹è±¡ç­‰äºè°ƒç”¨Androidæ˜ å°„çš„å¯¹è±¡
            test.hello("jsè°ƒç”¨äº†androidä¸­çš„helloæ–¹æ³•");
         }
      </script>
   </head>
   <body>
      //ç‚¹å‡»æŒ‰é’®åˆ™è°ƒç”¨callAndroidå‡½æ•°
      <button type="button" id="button1" onclick="callAndroid()"></button>
   </body>
</html>
```
**Android ç«¯ï¼š**   

![Android](http://images.pingan8787.com/20190623HybridApp15.png)


2. **é€šè¿‡ `WebViewClient` çš„ `shouldOverrideUrlLoading ()` æ–¹æ³•å›è°ƒæ‹¦æˆª `url`ï¼š**

**Web ç«¯ï¼š**

```html
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>å‰ç«¯ä»£ç </title>
        <script>
            function callAndroid(){
                /*çº¦å®šçš„urlåè®®ä¸ºï¼šjs://webview?arg1=111&arg2=222*/
                document.location = "js://webview?arg1=111&arg2=222";
            }
        </script>
    </head>
    <!-- ç‚¹å‡»æŒ‰é’®åˆ™è°ƒç”¨callAndroidï¼ˆï¼‰æ–¹æ³•  -->
    <body>
        <button type="button" id="button1" 
            onclick="callAndroid()"
        >ç‚¹å‡»è°ƒç”¨Androidä»£ç </button>
    </body>
</html>
```

**Android ç«¯ï¼š**  

![Android](http://images.pingan8787.com/20190623HybridApp16.png)

3. **é€šè¿‡ WebChromeClient çš„æ–¹æ³•å›è°ƒæ‹¦æˆªJSå¯¹è¯æ¡†æ–¹æ³•ï¼š**

é€šè¿‡ WebChromeClient çš„ `onJsAlert()` ã€`onJsConfirm()` ã€`onJsPrompt()`æ–¹æ³•å›è°ƒæ‹¦æˆªJSå¯¹è¯æ¡† `alert()` ã€`confirm()`ã€`prompt()` æ¶ˆæ¯ã€‚   

**Web ç«¯ï¼š**   

```html
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>å‰ç«¯ä»£ç </title>
        <script>
            function clickprompt(){
            // è°ƒç”¨promptï¼ˆï¼‰
            var result=prompt("js://demo?arg1=111&arg2=222");
                alert("demo " + result);
            }
        </script>
    </head>
    <!-- ç‚¹å‡»æŒ‰é’®åˆ™è°ƒç”¨clickprompt()  -->
    <body>
        <button type="button" id="button1" 
            onclick="clickprompt()"
        >ç‚¹å‡»è°ƒç”¨Androidä»£ç </button>
    </body>
</html>
```

**Android ç«¯ï¼š**  

![Android](http://images.pingan8787.com/20190623HybridApp17.png)


#### 5.2 iOS å®ç°æ–¹å¼

##### 5.2.1 JS è°ƒç”¨ iOS çš„ 2 ç§æ–¹å¼  

1. **ä½¿ç”¨ `XMLHttpRequest` å‘èµ·è¯·æ±‚çš„æ–¹å¼ï¼š**

**Web ç«¯ï¼š**   

![iOS](http://images.pingan8787.com/20190623HybridApp18.png)

**XMLHttpRequest bridgeï¼š**

JS ç«¯ä½¿ç”¨ `XMLHttpRequest` å‘èµ·äº†ä¸€ä¸ªè¯·æ±‚ï¼š`execXhr.open('HEAD', "/!gap_exec?" + (+new Date()), true);`ï¼Œè¯·æ±‚çš„åœ°å€æ˜¯ `/!gap_exec`ï¼›å¹¶æŠŠè¯·æ±‚çš„æ•°æ®æ”¾åœ¨äº†è¯·æ±‚çš„ header é‡Œé¢ï¼Œè§è¿™å¥ä»£ç ï¼š`execXhr.setRequestHeader('cmds', iOSExec.nativeFetchMessages());`ã€‚

è€Œåœ¨ Objective-C ç«¯ä½¿ç”¨ä¸€ä¸ª `NSURLProtocol` çš„å­ç±»æ¥æ£€æŸ¥æ¯ä¸ªè¯·æ±‚ï¼Œå¦‚æœåœ°å€æ˜¯ `/!gap_exec` çš„è¯ï¼Œåˆ™è®¤ä¸ºæ˜¯ Cordova é€šä¿¡çš„è¯·æ±‚ï¼Œç›´æ¥æ‹¦æˆªï¼Œæ‹¦æˆªåå°±å¯ä»¥é€šè¿‡åˆ†æè¯·æ±‚çš„æ•°æ®ï¼Œåˆ†å‘åˆ°ä¸åŒçš„æ’ä»¶ç±»(CDVPlugin ç±»çš„å­ç±»)çš„æ–¹æ³•ä¸­ï¼š
 

![iOS](http://images.pingan8787.com/20190623HybridApp19.png)

Cordova ä¸­ä¼˜å…ˆä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œ` Cordova.js`  ä¸­çš„æ³¨é‡Šæœ‰æåŠä¸ºä»€ä¹ˆä¼˜å…ˆä½¿ç”¨ ` XMLHttpRequest`  çš„æ–¹å¼ï¼ŒåŠä¸ºä»€ä¹ˆä¿ç•™ç¬¬äºŒç§ ` iframe bridge ` çš„é€šä¿¡æ–¹å¼:

```
// XHR mode does not work on iOS 4.2, so default to IFRAME_NAV for such devices.
// XHR modeâ€™s main advantage is working around a bug in -webkit-scroll, which
// doesnâ€™t exist in 4.X devices anyways123
```

**iframe bridgeï¼š**

åœ¨ JS ç«¯åˆ›å»ºä¸€ä¸ªé€æ˜çš„ `iframe`ï¼Œè®¾ç½®è¿™ä¸ª `ifame` çš„ `src` ä¸ºè‡ªå®šä¹‰çš„åè®®ï¼Œè€Œ `ifame `çš„ `src` æ›´æ”¹æ—¶ï¼Œ`UIWebView` ä¼šå…ˆå›è°ƒå…¶ `delegate` çš„ `webView:shouldStartLoadWithRequest:navigationType:` æ–¹æ³•ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š

![iOS](http://images.pingan8787.com/20190623HybridApp20.png)

2. **é€šè¿‡è®¾ç½®é€æ˜çš„ `iframe` çš„ `src` å±æ€§ï¼š**


##### 5.2.2 iOS è°ƒç”¨ JS çš„æ–¹å¼    

`UIWebView` æœ‰ä¸€ä¸ªè¿™æ ·çš„æ–¹æ³• `stringByEvaluatingJavaScriptFromString:`ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è®©ä¸€ä¸ª `UIWebView` å¯¹è±¡æ‰§è¡Œä¸€æ®µ JS ä»£ç ï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ° Objective-C è·Ÿ JS é€šä¿¡çš„æ•ˆæœï¼Œåœ¨ Cordova çš„ä»£ç ä¸­å¤šå¤„ç”¨åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸¤å¤„å¦‚ä¸‹ï¼š

1. **è·å– JS çš„è¯·æ±‚æ•°æ®ï¼š**


![iOS](http://images.pingan8787.com/20190623HybridApp21.png)

2. **æŠŠ JS è¯·æ±‚çš„ç»“æœè¿”å›ç»™ JS ç«¯ï¼š**

![iOS](http://images.pingan8787.com/20190623HybridApp22.png)

### ç»“è¯­

å¯¹äºåˆå…¥æ··åˆåº”ç”¨å¼€å‘çš„å°ä¼™ä¼´ï¼Œè¿™äº›ä¼šæœ‰ç‚¹éš¾åº¦ï¼Œä½†æ˜¯å¥½å¥½ç†è§£ä¸‹é‚£å‡ å¼ æµç¨‹å›¾ï¼Œå†ç†ä¸€ç†æ€è·¯ï¼Œç›¸ä¿¡ä¼šæœ‰å¸®åŠ©ğŸ˜

ç»™å¤§å®¶åŠ åŠ æ²¹~~

### å…³äºæˆ‘

> æœ¬æ–‡é¦–å‘åœ¨ [pingan8787ä¸ªäººåšå®¢](http://www.pingan8787.com)ï¼Œå¦‚éœ€è½¬è½½è¯·ä¿ç•™ä¸ªäººä»‹ç»ã€‚

|Author|ç‹å¹³å®‰|
|---|---|
|E-mail|pingan8787@qq.com|
|åš  å®¢|www.pingan8787.com|
|å¾®  ä¿¡|pingan8787|
|æ¯æ—¥æ–‡ç« æ¨è|https://github.com/pingan8787/Leo_Reading/issues|
|ESå°å†Œ|js.pingan8787.com|

## å¾®ä¿¡å…¬ä¼—å·
![bg](http://images.pingan8787.com/2019_07_12guild_page.png)  