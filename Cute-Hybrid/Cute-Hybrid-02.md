
![bg](http://images.pingan8787.com/Hybrid%E5%B0%81%E9%9D%A22.png)


### å‰è¨€

æˆ‘ä»¬å¤§å‰ç«¯å›¢é˜Ÿå†…éƒ¨ ğŸ“–**æ¯å‘¨ä¸€ç»ƒ** çš„çŸ¥è¯†å¤ä¹ è®¡åˆ’ç»§ç»­åŠ æ²¹ï¼Œæœ¬ç¯‡æ–‡ç« æ˜¯ **ã€ŠHybrid APP æ··åˆåº”ç”¨ä¸“é¢˜ã€‹** ä¸»é¢˜çš„ç¬¬äºŒæœŸå’Œç¬¬ä¸‰æœŸçš„åˆé›†ã€‚  

è¿™ä¸€æœŸå…±æ•´ç†äº† 10 ä¸ªé—®é¢˜ï¼Œå’Œç›¸åº”çš„å‚è€ƒç­”æ¡ˆï¼Œæ–‡å­—å’Œå›¾ç‰‡è¾ƒå¤šï¼Œ**å»ºè®®å¤§å®¶å¯ä»¥æ”¶è—ï¼Œæ ¹æ®æ–‡ç« ç›®å½•æ¥é˜…è¯»**ã€‚

ä¹‹å‰åˆ†äº«çš„æ¯å‘¨å†…å®¹ï¼Œæˆ‘éƒ½æ•´ç†åˆ°æ˜é‡‘æ”¶è—é›† [ğŸ“”ã€ŠEFTæ¯å‘¨ä¸€ç»ƒã€‹](https://juejin.im/collection/5cd11b0af265da0346227e24) ä¸Šå•¦ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—å’¯ğŸ’•ğŸ’•ã€‚  

**å†…å®¹å›é¡¾ï¼š**

1. [ã€ŠEFT æ¯å‘¨åˆ†äº« â€”â€” Hybrid App åº”ç”¨å¼€å‘ä¸­ 5 ä¸ªå¿…å¤‡çŸ¥è¯†ç‚¹å¤ä¹ ã€‹](https://juejin.im/post/5d125306e51d45773e418aab)

2. [ã€ŠEFT æ¯å‘¨åˆ†äº« â€”â€” HTTP çš„15ä¸ªå¸¸è§çŸ¥è¯†ç‚¹å¤ä¹ ã€‹](https://juejin.im/post/5d0de954e51d4556be5b3a6f)

3. [ã€ŠEFT æ¯å‘¨åˆ†äº« â€”â€” æ•°æ®ç»“æ„ä¸ç®—æ³•åˆé›†ã€‹](https://juejin.im/collection/5cd11b0af265da0346227e24)

**æ–‡ç« æ”¶å½•ï¼š** 

æœ¬ç³»åˆ—æ‰€æœ‰æ–‡ç« ï¼Œéƒ½å°†æ”¶å½•åœ¨ Github ä¸Šï¼Œ[æ¬¢è¿ç‚¹å‡»æŸ¥é˜…](https://github.com/pingan8787/Leo-EveryWeek)ã€‚   

> æ³¨ï¼šæœ¬æ–‡æ•´ç†éƒ¨åˆ†èµ„æ–™æ¥æºç½‘ç»œï¼Œæœ‰äº›å›¾ç‰‡/æ®µè½æ‰¾ä¸åˆ°åŸæ–‡å‡ºå¤„ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè”ç³»åˆ é™¤ã€‚


### ä¸€ã€iOS å¹³å°ä¸­ UIWebView ä¸ WKWebView æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> å‚è€ƒæ–‡ç« ï¼š[ã€ŠUIWebViewä¸WKWebViewã€‹](http://www.cocoachina.com/articles/17337)

`UIWebView` æ˜¯è‹¹æœç»§æ‰¿äº `UIView` å°è£…çš„ä¸€ä¸ªåŠ è½½ web å†…å®¹çš„ç±»,å®ƒå¯ä»¥åŠ è½½ä»»ä½•è¿œç«¯çš„webæ•°æ®å±•ç¤ºåœ¨ä½ çš„é¡µé¢ä¸Šï¼Œä½ å¯ä»¥åƒæµè§ˆå™¨ä¸€æ ·å‰è¿›åé€€åˆ·æ–°ç­‰æ“ä½œã€‚ä¸è¿‡è‹¹æœåœ¨ iOS8 ä»¥åæ¨å‡ºäº† `WKWebView` æ¥åŠ è½½ Webï¼Œå¹¶åº”ç”¨äº iOS å’Œ OSX ä¸­ï¼Œå®ƒå–ä»£äº† `UIWebView` å’Œ `WebView` ï¼Œåœ¨ä¸¤ä¸ªå¹³å°ä¸Šæ”¯æŒåŒä¸€å¥— APIã€‚

å®ƒè„±ç¦»äº `UIWebView` çš„è®¾è®¡ï¼Œå°†åŸæœ¬çš„è®¾è®¡æ‹†åˆ†æˆ14ä¸ªç±»ï¼Œå’Œ3ä¸ªä»£ç†åè®®ï¼Œè™½ç„¶æ˜¯è¿™æ ·ä½†æ˜¯äº†è§£ä¹‹åå…¶å®ç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œä¾ç…§èŒè´£å•ä¸€çš„åŸåˆ™ï¼Œæ¯ä¸ªåè®®åšçš„äº‹æƒ…æ ¹æ®åŠŸèƒ½åˆ†ç±»ã€‚

![UIWebView](http://cdn.cocimg.com/ueditor/upload/image/20160810/1470807807124957.png)

`WKWebView` ä¸ `UIWebView` çš„åŒºåˆ«ï¼š  

* `WKWebView` çš„å†…å­˜è¿œè¿œæ²¡æœ‰ `UIWebView` çš„å¼€é”€å¤§,è€Œä¸”æ²¡æœ‰ç¼“å­˜ï¼›

* `WKWebView` æ‹¥æœ‰é«˜è¾¾ 60FPS æ»šåŠ¨åˆ·æ–°ç‡åŠå†…ç½®æ‰‹åŠ¿ï¼›

* `WKWebView` æ”¯æŒäº†æ›´å¤šçš„ HTML5 ç‰¹æ€§ï¼›

* `WKWebView` é«˜æ•ˆçš„ app å’Œ web ä¿¡æ¯äº¤æ¢é€šé“ï¼›

* `WKWebView` å…è®¸ `JavaScript` çš„ `Nitro` åº“åŠ è½½å¹¶ä½¿ç”¨, `UIWebView` ä¸­é™åˆ¶äº†ï¼›

* `WKWebView` ç›®å‰ç¼ºå°‘å…³äºé¡µç ç›¸å…³çš„ APIï¼›

* `WKWebView` æä¾›åŠ è½½ç½‘é¡µè¿›åº¦çš„å±æ€§ï¼›

* `WKWebView` ä½¿ç”¨ Safari ç›¸åŒçš„ JavaScript å¼•æ“ï¼›  

* `WKWebView` å¢åŠ åŠ è½½è¿›åº¦å±æ€§ï¼š `estimatedProgress` ï¼›

* `WKWebView` ä¸æ”¯æŒé¡µé¢ç¼“å­˜ï¼Œéœ€è¦è‡ªå·±æ³¨å…¥ `cookie` , è€Œ `UIWebView` æ˜¯è‡ªåŠ¨æ³¨å…¥ `cookie` ï¼›

* `WKWebView` æ— æ³•å‘é€ `POST` å‚æ•°é—®é¢˜ï¼›

* `WKWebView` å¯ä»¥å’Œjsç›´æ¥äº’è°ƒå‡½æ•°ï¼Œä¸åƒ `UIWebView` éœ€è¦ç¬¬ä¸‰æ–¹åº“ `WebViewJavascriptBridge` æ¥ååŠ©å¤„ç†å’Œ js çš„äº¤äº’ï¼›


**æ³¨æ„ï¼š**

å¤§å¤šæ•°Appéœ€è¦æ”¯æŒ `iOS7` ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œè€Œ `WKWebView` åªåœ¨ `iOS8` åæ‰èƒ½ç”¨ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå…¼å®¹æ€§æ–¹æ¡ˆï¼Œæ—¢ `iOS7` ä¸‹ç”¨ `UIWebView` ï¼Œ`iOS8` åç”¨ `WKWebView` ã€‚ä½†æ˜¯ç›®å‰ `IOS10` ä»¥ä¸‹çš„ç³»ç»Ÿä»¥åŠå¾ˆå°‘äº†ï¼Œ

**å°ç»“ï¼š**   

`WKWebView` ç›¸è¾ƒäº `UIWebView` åœ¨æ•´ä½“ä¸Šæœ‰è¾ƒå¤§çš„æå‡ï¼Œæ»¡è¶³ iOS ä¸Šé¢ä½¿ç”¨åŒä¸€å¥—æ§ä»¶çš„åŠŸèƒ½ï¼ŒåŒæ—¶å¯¹æ•´ä¸ªå†…å­˜çš„å¼€é”€ä»¥åŠæ»šåŠ¨åˆ·æ–°ç‡å’Œ JS äº¤äº’åšäº†ä¼˜åŒ–çš„å¤„ç†ã€‚

ä¾æ®**èŒè´£å•ä¸€åŸåˆ™**ï¼Œæ‹†åˆ†æˆäº†ä¸‰ä¸ªåè®®å»å®ç° `WebView` çš„å“åº”ï¼Œè§£è€¦äº† JS äº¤äº’å’ŒåŠ è½½è¿›åº¦çš„å“åº”å¤„ç†ã€‚ 

`WKWebView` æ²¡æœ‰åšç¼“å­˜å¤„ç†,æ‰€ä»¥**å¯¹ç½‘é¡µéœ€è¦ç¼“å­˜çš„åŠ è½½æ€§èƒ½è¦æ±‚æ²¡é‚£ä¹ˆé«˜**çš„è¿˜æ˜¯å¯ä»¥è€ƒè™‘ `UIWebView` ã€‚

### äºŒã€WKWebView æœ‰å“ªä¸€äº›å‘ï¼Ÿ

> å‚è€ƒæ–‡ç« ï¼š[ã€ŠWKWebView é‚£äº›å‘ã€‹](https://kknews.cc/tech/x2rzg3g.html)


#### 1. WKWebView ç™½å±é—®é¢˜

`WKWebView` å®é™…ä¸Šæ˜¯ä¸ªå¤šè¿›ç¨‹ç»„ä»¶ï¼Œè¿™ä¹Ÿæ˜¯å®ƒåŠ è½½é€Ÿåº¦æ›´å¿«ï¼Œå†…å­˜æš‚ç”¨æ›´ä½çš„åŸå› ã€‚

åœ¨ `UIWebView` ä¸Šå½“å†…å­˜å ç”¨å¤ªå¤§çš„æ—¶å€™ï¼ŒApp Process ä¼š crashï¼›è€Œåœ¨ `WKWebView` ä¸Šå½“æ€»ä½“çš„å†…å­˜å ç”¨æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒWebContent Process ä¼š crashï¼Œä»è€Œå‡ºç°ç™½å±ç°è±¡ã€‚

**è§£å†³åŠæ³•ï¼š**

1. **å€ŸåŠ© WKNavigtionDelegate**  

å½“ `WKWebView` æ€»ä½“å†…å­˜å ç”¨è¿‡å¤§ï¼Œé¡µé¢å³å°†ç™½å±çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ä¸Šé¢çš„å›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬åœ¨è¯¥å‡½æ•°é‡Œæ‰§è¡Œ`[webView reload]`(è¿™ä¸ªæ—¶å€™ `webView.URL` å–å€¼å°šä¸ä¸º` nil`ï¼‰è§£å†³ç™½å±é—®é¢˜ã€‚åœ¨ä¸€äº›é«˜å†…å­˜æ¶ˆè€—çš„é¡µé¢å¯èƒ½ä¼šé¢‘ç¹åˆ·æ–°å½“å‰é¡µé¢ï¼ŒH5ä¾§ä¹Ÿè¦åšç›¸åº”çš„é€‚é…æ“ä½œã€‚

2. **æ£€æµ‹ webView.title æ˜¯å¦ä¸ºç©º**

å¹¶ä¸æ˜¯æ‰€æœ‰ H5 é¡µé¢ç™½å±çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ä¸Šé¢çš„å›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚ï¼Œæœ€è¿‘é‡åˆ°åœ¨ä¸€ä¸ªé«˜å†…å­˜æ¶ˆè€—çš„ H5 é¡µé¢ä¸Š present ç³»ç»Ÿç›¸æœºï¼Œæ‹ç…§å®Œæ¯•åè¿”å›åŸæ¥é¡µé¢çš„æ—¶å€™å‡ºç°ç™½å±ç°è±¡ï¼ˆæ‹ç…§è¿‡ç¨‹æ¶ˆè€—äº†å¤§é‡å†…å­˜ï¼Œå¯¼è‡´å†…å­˜ç´§å¼ ï¼ŒWebContent Process è¢«ç³»ç»ŸæŒ‚èµ·ï¼‰ï¼Œä½†ä¸Šé¢çš„å›è°ƒå‡½æ•°å¹¶æ²¡æœ‰è¢«è°ƒç”¨ã€‚åœ¨ `WKWebView` ç™½å±çš„æ—¶å€™ï¼Œå¦ä¸€ç§ç°è±¡æ˜¯ `webView.titile` ä¼šè¢«ç½®ç©º, å› æ­¤ï¼Œå¯ä»¥åœ¨ `viewWillAppear` çš„æ—¶å€™æ£€æµ‹ `webView.title` æ˜¯å¦ä¸ºç©ºæ¥ `reload` é¡µé¢ã€‚


#### 2. WKWebView Cookie é—®é¢˜

`WKWebView` `Cookie` é—®é¢˜åœ¨äº `WKWebView` å‘èµ·çš„è¯·æ±‚ä¸ä¼šè‡ªåŠ¨å¸¦ä¸Šå­˜å‚¨äº `NSHTTPCookieStorage` å®¹å™¨ä¸­çš„ `Cookie`ï¼Œè€Œåœ¨ `UIWebView` ä¼šè‡ªåŠ¨å¸¦ä¸Š `Cookie`ã€‚  

**åŸå› æ˜¯ï¼š**   

`WKWebView` æ‹¥æœ‰è‡ªå·±çš„ç§æœ‰å­˜å‚¨ï¼Œä¸ä¼šå°† `Cookie` å­˜å…¥åˆ°æ ‡å‡†çš„ `Cookie` å®¹å™¨`NSHTTPCookieStorage` ä¸­ã€‚

å®è·µå‘ç° `WKWebView` å®ä¾‹å…¶å®ä¹Ÿä¼šå°† `Cookie` å­˜å‚¨äº `NSHTTPCookieStorage` ä¸­ï¼Œä½†å­˜å‚¨æ—¶æœºæœ‰å»¶è¿Ÿï¼Œåœ¨ `iOS 8 `ä¸Šï¼Œå½“é¡µé¢è·³è½¬çš„æ—¶å€™ï¼Œå½“å‰é¡µé¢çš„ `Cookie` ä¼šå†™å…¥ `NSHTTPCookieStorage` ä¸­ï¼Œè€Œåœ¨ `iOS 10` ä¸Šï¼ŒJS æ‰§è¡Œ `document.cookie` æˆ–æœåŠ¡å™¨ `set-cookie` æ³¨å…¥çš„ `Cookie` ä¼šå¾ˆå¿«åŒæ­¥åˆ° `NSHTTPCookieStorage` ä¸­ï¼ŒFireFox å·¥ç¨‹å¸ˆæ›¾å»ºè®®é€šè¿‡ `reset WKProcessPool` æ¥è§¦å‘ `Cookie` åŒæ­¥åˆ° `NSHTTPCookieStorage` ä¸­ï¼Œå®è·µå‘ç°ä¸èµ·ä½œç”¨ï¼Œå¹¶å¯èƒ½ä¼šå¼•å‘å½“å‰é¡µé¢ `session cookie `ä¸¢å¤±ç­‰é—®é¢˜ã€‚

**è§£å†³åŠæ³•1ï¼š**  

`WKWebView loadRequest` å‰ï¼Œåœ¨ `request header` ä¸­è®¾ç½® `Cookie`, è§£å†³é¦–ä¸ªè¯·æ±‚ `Cookie` å¸¦ä¸ä¸Šçš„é—®é¢˜ï¼›

**è§£å†³åŠæ³•2ï¼š**  

é€šè¿‡ `document.cookie` è®¾ç½® `Cookie` è§£å†³åç»­é¡µé¢(åŒåŸŸ)`Ajax``ã€iframe` è¯·æ±‚çš„ `Cookie` é—®é¢˜ï¼›(æ³¨æ„ï¼š`document.cookie()` æ— æ³•è·¨åŸŸè®¾ç½® `cookie`)ã€‚

#### 3. WKWebView loadRequest é—®é¢˜

åœ¨ `WKWebView` ä¸Šé€šè¿‡ `loadRequest` å‘èµ·çš„ `post` è¯·æ±‚ `body` æ•°æ®ä¼šä¸¢å¤±ï¼ŒåŒæ ·æ˜¯ç”±äº**è¿›ç¨‹é—´é€šä¿¡æ€§èƒ½é—®é¢˜**ï¼Œ `HTTPBody` å­—æ®µè¢«ä¸¢å¼ƒã€‚

#### 4. WKWebView NSURLProtocolé—®é¢˜

`WKWebView` åœ¨ç‹¬ç«‹äº app è¿›ç¨‹ä¹‹å¤–çš„è¿›ç¨‹ä¸­æ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼Œè¯·æ±‚æ•°æ®ä¸ç»è¿‡ä¸»è¿›ç¨‹ï¼Œå› æ­¤ï¼Œåœ¨ `WKWebView` ä¸Šç›´æ¥ä½¿ç”¨ `NSURLProtocol` æ— æ³•æ‹¦æˆªè¯·æ±‚ã€‚

**è§£å†³åŠæ³•ï¼š**  

ç”±äº `WKWebView` åœ¨ç‹¬ç«‹è¿›ç¨‹é‡Œæ‰§è¡Œç½‘ç»œè¯·æ±‚ã€‚ä¸€æ—¦æ³¨å†Œ `http(s) scheme` åï¼Œç½‘ç»œè¯·æ±‚å°†ä» `Network Process` å‘é€åˆ° `App Process`ï¼Œè¿™æ · `NSURLProtocol` æ‰èƒ½æ‹¦æˆªç½‘ç»œè¯·æ±‚ã€‚åœ¨ `webkit2` çš„è®¾è®¡é‡Œä½¿ç”¨ `MessageQueue` è¿›è¡Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼ŒNetwork Process ä¼šå°†è¯·æ±‚ `encode` æˆä¸€ä¸ª `Message`,ç„¶åé€šè¿‡ IPC å‘é€ç»™` App Process`ã€‚å‡ºäºæ€§èƒ½çš„åŸå› ï¼Œ`encode` çš„æ—¶å€™ `HTTPBody` å’Œ `HTTPBodyStream` è¿™ä¸¤ä¸ªå­—æ®µä¼šè¢«ä¸¢å¼ƒæ‰äº†ã€‚

#### 5. WKWebView é¡µé¢æ ·å¼é—®é¢˜

åœ¨ `WKWebView` é€‚é…è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°éƒ¨åˆ† H5 é¡µé¢å…ƒç´ ä½ç½®å‘ä¸‹åç§»æˆ–è¢«æ‹‰ä¼¸å˜å½¢ï¼Œè¿½è¸ªåå‘ç°ä¸»è¦æ˜¯ H5 é¡µé¢é«˜åº¦å€¼å¼‚å¸¸å¯¼è‡´ã€‚

**è§£å†³åŠæ³•ï¼š**  

è°ƒæ•´ `WKWebView` å¸ƒå±€æ–¹å¼ï¼Œé¿å…è°ƒæ•´` webView.scrollView.contentInset` ã€‚å®é™…ä¸Šï¼Œå³ä¾¿åœ¨  `UIWebView`  ä¸Šä¹Ÿä¸å»ºè®®ç›´æ¥è°ƒæ•´ `webView.scrollView.contentInset` çš„å€¼ï¼Œè¿™ç¡®å®ä¼šå¸¦æ¥ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ã€‚å¦‚æœæŸäº›ç‰¹æ®Šæƒ…å†µä¸‹éå¾—è°ƒæ•´ `contentInset` ä¸å¯çš„è¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢æ–¹å¼è®©H5é¡µé¢æ¢å¤æ­£å¸¸æ˜¾ç¤ºã€‚

#### 6. WKWebView æˆªå±é—®é¢˜

WKWebView ä¸‹é€šè¿‡ -[CALayer renderInContext:]å®ç°æˆªå±çš„æ–¹å¼å¤±æ•ˆï¼Œéœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°æˆªå±åŠŸèƒ½ï¼š

```
@implementation UIView (ImageSnapshot) 
- (UIImage*)imageSnapshot { 
    UIGraphicsBeginImageContextWithOptions(self.bounds.size,YES,self.contentScaleFactor);
    [self drawViewHierarchyInRect:self.bounds afterScreenUpdates:YES]; 
    UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext(); 
    UIGraphicsEndImageContext(); 
    return newImage; 
} 
@end
```

ç„¶è€Œè¿™ç§æ–¹å¼ä¾ç„¶è§£å†³ä¸äº† `webGL` é¡µé¢çš„æˆªå±é—®é¢˜ï¼Œæˆªå±ç»“æœä¸æ˜¯ç©ºç™½å°±æ˜¯çº¯é»‘å›¾ç‰‡ã€‚  

**è§£å†³åŠæ³•ï¼š**  

æ— å¥ˆä¹‹ä¸‹ï¼Œæˆ‘ä»¬åªèƒ½çº¦å®šä¸€ä¸ªJSæ¥å£ï¼Œè®©æ¸¸æˆå¼€å‘å•†å®ç°è¯¥æ¥å£ï¼Œå…·ä½“æ˜¯é€šè¿‡ `canvas` `getImageData()`æ–¹æ³•å–å¾—å›¾ç‰‡æ•°æ®åè¿”å› `base64` æ ¼å¼çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯åœ¨éœ€è¦æˆªå›¾çš„æ—¶å€™ï¼Œè°ƒç”¨è¿™ä¸ªJSæ¥å£è·å–` base64 String `å¹¶è½¬æ¢æˆ `UIImage`ã€‚

#### 7. WKWebView crashé—®é¢˜

å¦‚æœ `WKWebView` é€€å‡ºçš„æ—¶å€™ï¼ŒJSåˆšå¥½æ‰§è¡Œäº† `window.alert()`,  alert æ¡†å¯èƒ½å¼¹ä¸å‡ºæ¥ï¼Œ`completionHandler` æœ€åæ²¡æœ‰è¢«æ‰§è¡Œï¼Œå¯¼è‡´` crash`ï¼›

å¦ä¸€ç§æƒ…å†µæ˜¯åœ¨ `WKWebView` ä¸€æ‰“å¼€ï¼ŒJSå°±æ‰§è¡Œ `window.alert()`ï¼Œè¿™ä¸ªæ—¶å€™ç”±äº `WKWebView` æ‰€åœ¨çš„ `UIViewController` å‡ºç°ï¼ˆ `push` æˆ– `present` ï¼‰çš„åŠ¨ç”»å°šæœªç»“æŸï¼Œalert æ¡†å¯èƒ½å¼¹ä¸å‡ºæ¥ï¼Œ`completionHandler `æœ€åæ²¡æœ‰è¢«æ‰§è¡Œï¼Œå¯¼è‡´ `crash`ã€‚   

#### 8. è§†é¢‘è‡ªåŠ¨æ’­æ”¾

`WKWebView` éœ€è¦é€šè¿‡ `WKWebViewConfiguration.mediaPlaybackRequiresUserAction` è®¾ç½®æ˜¯å¦å…è®¸è‡ªåŠ¨æ’­æ”¾ï¼Œä½†ä¸€å®šè¦åœ¨ `WKWebView` åˆå§‹åŒ–ä¹‹å‰è®¾ç½®ï¼Œåœ¨ `WKWebView` åˆå§‹åŒ–ä¹‹åè®¾ç½®æ— æ•ˆã€‚


#### 9. goBack APIé—®é¢˜

`WKWebView` ä¸Šè°ƒç”¨ `-[WKWebView goBack]`, å›é€€åˆ°ä¸Šä¸€ä¸ªé¡µé¢åä¸ä¼šè§¦å‘`window.onload()` å‡½æ•°ã€ä¸ä¼šæ‰§è¡ŒJSã€‚

#### 10. é¡µé¢æ»šåŠ¨é€Ÿç‡

`WKWebView` éœ€è¦é€šè¿‡ `scrollView delegate` è°ƒæ•´æ»šåŠ¨é€Ÿç‡ï¼š

```
- (void)scrollViewWillBeginDragging:(UIScrollView *)scrollView {
    scrollView.decelerationRate = UIScrollViewDecelerationRateNormal; 
}
```

### ä¸‰ã€Crosswalk æ˜¯ä»€ä¹ˆï¼Œå®ƒæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

> å‚è€ƒç½‘ç«™ï¼š [ã€ŠCrosswalk Githubã€‹](https://Crosswalk-project.org/) 
> å‚è€ƒæ–‡ç« ï¼š [ã€ŠCrosswalkå…¥é—¨ã€‹](https://www.mobibrw.com/2015/1934)

**Crosswalk** æ˜¯ä¸€æ¬¾å¼€æºçš„ web å¼•æ“ã€‚ç›®å‰ **Crosswalk** æ­£å¼æ”¯æŒçš„ç§»åŠ¨æ“ä½œç³»ç»ŸåŒ…æ‹¬ Android å’Œ Tizen ï¼Œåœ¨ Android 4.0 åŠä»¥ä¸Šçš„ç³»ç»Ÿä¸­ä½¿ç”¨ **Crosswalk** çš„ Web åº”ç”¨ç¨‹åºåœ¨ HTML5 æ–¹é¢å¯ä»¥æœ‰ä¸€è‡´çš„ä½“éªŒï¼Œ**åŒæ—¶å’Œç³»ç»Ÿçš„æ•´åˆäº¤äº’æ–¹é¢ï¼ˆæ¯”å¦‚å¯åŠ¨ç”»é¢ã€æƒé™ç®¡ç†ã€åº”ç”¨åˆ‡æ¢ã€ç¤¾äº¤åˆ†äº«ç­‰ç­‰ï¼‰å¯ä»¥åšåˆ°ç±»ä¼¼åŸç”Ÿåº”ç”¨**ã€‚

ç°åœ¨ **Crosswalk** å·²ç»æˆä¸ºä¼—å¤šçŸ¥å HTML5 å¹³å°å’Œåº”ç”¨çš„æ¨èå¼•æ“ï¼ŒåŒ…æ‹¬ Google Mobile Chrome App ã€ Intel XDK ã€ Famo.us å’Œ Construct2 ç­‰ç­‰ï¼Œæœªæ¥çš„ Cordova 4.0 ä¹Ÿè®¡åˆ’é›†æˆ **Crosswalk** ã€‚



### å››ã€å¸¸è§çš„ WebView æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆæœ‰å“ªä¸€äº›ï¼Ÿ

#### 0. é—®é¢˜åˆ†æ

é¦–å…ˆéœ€è¦äº†è§£ï¼Œå¯¹äºä¸€ä¸ªæ™®é€šç”¨æˆ·æ¥è®²ï¼Œæ‰“å¼€ä¸€ä¸ª WebView é€šå¸¸ä¼šç»å†å“ªå‡ ä¸ªé˜¶æ®µï¼Œä¸€èˆ¬æœ‰è¿™äº›ï¼š

1. äº¤äº’æ— åé¦ˆ;

2. åˆ°è¾¾æ–°çš„é¡µé¢ï¼Œé¡µé¢ç™½å±;

3. é¡µé¢åŸºæœ¬æ¡†æ¶å‡ºç°ï¼Œä½†æ˜¯æ²¡æœ‰æ•°æ®ï¼›é¡µé¢å¤„äºloadingçŠ¶æ€;

4. å‡ºç°æ‰€éœ€çš„æ•°æ®;

![webview1](http://images.pingan8787.com/20190712Hybrid01.jpeg)   

å½“ App é¦–æ¬¡æ‰“å¼€æ—¶ï¼Œé»˜è®¤æ˜¯å¹¶ä¸åˆå§‹åŒ–æµè§ˆå™¨å†…æ ¸çš„ï¼›åªæœ‰å½“åˆ›å»º `WebView` å®ä¾‹çš„æ—¶å€™ï¼Œæ‰ä¼šåˆ›å»º `WebView` çš„åŸºç¡€æ¡†æ¶ã€‚

æ‰€ä»¥ä¸æµè§ˆå™¨ä¸åŒï¼ŒApp ä¸­æ‰“å¼€ `WebView` çš„ç¬¬ä¸€æ­¥å¹¶ä¸æ˜¯å»ºç«‹è¿æ¥ï¼Œè€Œæ˜¯å¯åŠ¨æµè§ˆå™¨å†…æ ¸ã€‚

äºæ˜¯æˆ‘ä»¬æ‰¾åˆ°äº†â€œ**ä¸ºä»€ä¹ˆWebViewæ€»æ˜¯å¾ˆæ…¢**â€çš„åŸå› ä¹‹ä¸€ï¼š

* åœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬è¾“å…¥åœ°å€æ—¶ï¼ˆç”šè‡³åœ¨ä¹‹å‰ï¼‰ï¼Œæµè§ˆå™¨å°±å¯ä»¥å¼€å§‹åŠ è½½é¡µé¢ã€‚

* è€Œåœ¨å®¢æˆ·ç«¯ä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦å…ˆèŠ±è´¹æ—¶é—´åˆå§‹åŒ– `WebView` å®Œæˆåï¼Œæ‰å¼€å§‹åŠ è½½ã€‚


è€Œè¿™æ®µæ—¶é—´ï¼Œç”±äºWebViewè¿˜ä¸å­˜åœ¨ï¼Œæ‰€æœ‰åç»­çš„è¿‡ç¨‹æ˜¯å®Œå…¨é˜»å¡çš„ã€‚å› æ­¤ç”±äºè¿™æ®µè¿‡ç¨‹å‘ç”Ÿåœ¨ native çš„ä»£ç ä¸­ï¼Œå•çº¯é å‰ç«¯ä»£ç æ˜¯æ— æ³•ä¼˜åŒ–çš„ï¼›å¤§éƒ¨åˆ†çš„æ–¹æ¡ˆéƒ½æ˜¯å‰ç«¯å’Œå®¢æˆ·ç«¯åä½œå®Œæˆï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªä¸šç•Œé‡‡ç”¨è¿‡çš„æ–¹æ¡ˆï¼š   

#### 1. å…¨å±€ WebView

åœ¨å®¢æˆ·ç«¯åˆšå¯åŠ¨æ—¶ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªå…¨å±€çš„ `WebView` å¾…ç”¨ï¼Œå¹¶éšè—ï¼Œå½“ç”¨æˆ·è®¿é—®äº† `WebView` æ—¶ï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸ª `WebView` åŠ è½½å¯¹åº”ç½‘é¡µï¼Œå¹¶å±•ç¤ºã€‚

è¿™ç§æ–¹æ³•å¯ä»¥**æ¯”è¾ƒæœ‰æ•ˆçš„å‡å°‘ WebView åœ¨Appä¸­çš„é¦–æ¬¡æ‰“å¼€æ—¶é—´**ã€‚å½“ç”¨æˆ·è®¿é—®é¡µé¢æ—¶ï¼Œä¸éœ€è¦åˆå§‹åŒ– WebView çš„æ—¶é—´ã€‚

 
å½“ç„¶è¿™ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š

* é¢å¤–çš„å†…å­˜æ¶ˆè€—ã€‚

* é¡µé¢é—´è·³è½¬éœ€è¦æ¸…ç©ºä¸Šä¸€ä¸ªé¡µé¢çš„ç—•è¿¹ï¼Œæ›´å®¹æ˜“å†…å­˜æ³„éœ²ã€‚

#### 2. WebView åŠ¨æ€åŠ è½½

> å‚è€ƒæ–‡ç« ï¼š[ã€ŠWebViewå¸¸ç”¨ä¼˜åŒ–æ–¹æ¡ˆã€‹](https://www.jianshu.com/p/f64e1b1c90d9)

`WebView` åŠ¨æ€åŠ è½½ã€‚å°±æ˜¯ä¸åœ¨ `xml` ä¸­å†™ `WebView` ï¼Œå†™ä¸€ä¸ª `layout` ï¼Œç„¶åæŠŠ `WebView` add è¿›å»ã€‚

```java
WebView mWebView = new WebView(getApplicationgContext());
LinearLayout mll = findViewById(R.id.xxx);
mll.addView(mWebView);

protected void onDestroy() {
    super.onDestroy();
    mWebView.removeAllViews();
    mWebView.destroy()
}
```

è¿™é‡Œç”¨çš„ `getApplicationContext()` ä¹Ÿæ˜¯é˜²æ­¢å†…å­˜æº¢å‡ºï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœä½ éœ€è¦åœ¨ `WebView` ä¸­æ‰“å¼€é“¾æ¥æˆ–è€…ä½ æ‰“å¼€çš„é¡µé¢å¸¦æœ‰ flashï¼Œè·å¾—ä½ çš„ `WebView` æƒ³å¼¹å‡ºä¸€ä¸ª `dialog` ï¼Œéƒ½ä¼šå¯¼è‡´ä» `ApplicationContext` åˆ° `ActivityContext` çš„å¼ºåˆ¶ç±»å‹è½¬æ¢é”™è¯¯ï¼Œä»è€Œå¯¼è‡´ä½ åº”ç”¨å´©æºƒã€‚

è¿™æ˜¯å› ä¸ºåœ¨åŠ è½½ flash çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆæŠŠä½ çš„ `WebView` ä½œä¸ºçˆ¶æ§ä»¶ï¼Œç„¶ååœ¨è¯¥æ§ä»¶ä¸Šç»˜åˆ¶ flash ï¼Œä»–æƒ³æ‰¾ä¸€ä¸ª `Activity` çš„ `Context` æ¥ç»˜åˆ¶ä»–ï¼Œä½†æ˜¯ä½ ä¼ å…¥çš„æ˜¯ `ApplicationContext` ã€‚ç„¶åå°±å´©æºƒäº†ã€‚

#### 3. ç‹¬ç«‹çš„webè¿›ç¨‹ï¼Œä¸ä¸»è¿›ç¨‹éš”å¼€

> å‚è€ƒæ–‡ç« ï¼š[ã€ŠWebViewå¸¸ç”¨ä¼˜åŒ–æ–¹æ¡ˆã€‹](https://www.jianshu.com/p/f64e1b1c90d9)

è¿™ä¸ªæ–¹æ³•è¢«è¿ç”¨äºç±»ä¼¼ qq ï¼Œå¾®ä¿¡è¿™æ ·çš„è¶…çº§ app ä¸­ï¼Œè¿™ä¹Ÿæ˜¯è§£å†³ä»»ä½• `WebView` å†…å­˜é—®é¢˜å±¡è¯•ä¸çˆ½çš„æ–¹æ³• å¯¹äºå°è£…çš„ `webactivity` ï¼Œåœ¨` manifest.xml` ä¸­è®¾ç½®ã€‚

```html
<activity 
    android:name=".webview.WebViewActivity" 
    android:launchMode="singleTop" 
    android:process=":remote" 
    android:screenOrientation="unspecified" 
/>
```

ç„¶ååœ¨å…³é—­ `webactivity` æ—¶é”€æ¯è¿›ç¨‹ï¼š  

```java
@Overrideprotected void onDestroy() {                
super.onDestroy(); 
    System.exit(0);
}
```
å…³é—­æµè§ˆå™¨åä¾¿é”€æ¯æ•´ä¸ªè¿›ç¨‹ï¼Œè¿™æ ·ä¸€èˆ¬ 95% çš„æƒ…å†µä¸‹ä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ä¹‹ç±»çš„é—®é¢˜ï¼Œä½†è¿™å°±æ¶‰åŠåˆ° android è¿›ç¨‹é—´é€šè®¯ï¼Œæ¯”è¾ƒä¸æ–¹ä¾¿å¤„ç†ï¼Œä¼˜åŠ£å‚åŠï¼Œä¹Ÿæ˜¯å¯é€‰çš„ä¸€ä¸ªæ–¹æ¡ˆã€‚   

#### 4. WebView é‡Šæ”¾

> å‚è€ƒæ–‡ç« ï¼š[ã€ŠWebViewå¸¸ç”¨ä¼˜åŒ–æ–¹æ¡ˆã€‹](https://www.jianshu.com/p/f64e1b1c90d9)

```java
public void destroy() {
    if (mWebView != null) {
        // å¦‚æœå…ˆè°ƒç”¨destroy()æ–¹æ³•ï¼Œåˆ™ä¼šå‘½ä¸­if (isDestroyed()) return;è¿™ä¸€è¡Œä»£ç ï¼Œéœ€è¦å…ˆonDetachedFromWindow()ï¼Œå†
        // destory()
        ViewParent parent = mWebView.getParent();
        if (parent != null) {
            ((ViewGroup) parent).removeView(mWebView);
        }
â€‹
        mWebView.stopLoading();
        // é€€å‡ºæ—¶è°ƒç”¨æ­¤æ–¹æ³•ï¼Œç§»é™¤ç»‘å®šçš„æœåŠ¡ï¼Œå¦åˆ™æŸäº›ç‰¹å®šç³»ç»Ÿä¼šæŠ¥é”™
        mWebView.getSettings().setJavaScriptEnabled(false);
        mWebView.clearHistory();
        mWebView.clearView();
        mWebView.removeAllViews();
â€‹
        try {
            mWebView.destroy();
        } catch (Throwable ex) {
â€‹
        }
    }
}
```

### äº”ã€åœ¨ Android å¹³å°ä¸‹å¦‚ä½•è°ƒè¯• WebViewï¼Ÿ

#### 1. åœ¨ Chrome æµè§ˆå™¨ä¸Šè°ƒè¯•
> å‚è€ƒæ–‡ç« ï¼š[ã€ŠAndroidè°ƒè¯•webviewã€‹](https://www.jianshu.com/p/3591eebbe797)     


**1.1 æ¡ä»¶ï¼š**   
* åœ¨ Android è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨è¿è¡Œ Android4.4 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ŒAndroid è®¾å¤‡ä¸Šå¯ç”¨ **USBè°ƒè¯•æ¨¡å¼**ã€‚

* Chrome 30 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚æ›´å¼ºå¤§çš„ WebView ç•Œé¢è°ƒè¯•åŠŸèƒ½éœ€è¦ Chrome31 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

* Android åº”ç”¨ç¨‹åºä¸­çš„ WebView é…ç½®ä¸º**å¯è°ƒè¯•æ¨¡å¼**ã€‚

**1.2 Android ä»£ç ä¸­é…ç½® WebView ä¸ºå¯è°ƒè¯•ï¼š**

```java
if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {  
    WebView.setWebContentsDebuggingEnabled(true);  
}  
```

æ³¨æ„ web è°ƒæµ‹ä¸å— `app manifest` æ–‡ä»¶ä¸­ `debuggable` æ ‡è®°çŠ¶æ€çš„å½±å“ï¼Œå¦‚æœå¸Œæœ›ä»… `debuggable` ä¸º `true` æ—¶æ‰èƒ½ä½¿ç”¨ web è°ƒæµ‹ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶æ£€æµ‹æ­¤æ ‡è®°ï¼Œå¦‚ä¸‹ï¼š

```java
if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {  
    if ( 0 != ( getApplcationInfo().flags &= ApplicationInfo.FLAG_DEBUGGABLE ) ) {  
        WebView.setWebContentsDebuggingEnabled(true);  
    }  
}  
```

**1.3 æ‰‹æœºå¼€å¯ USB è°ƒè¯•é€‰é¡¹ï¼Œå¹¶ç”¨ USB è¿æ¥ç”µè„‘ï¼š**   

å¼€å¯ Android æ‰‹æœºçš„å¼€å‘è€…é€‰é¡¹ï¼Œä¸€èˆ¬åœ¨ **ç³»ç»Ÿè®¾ç½®** - **Androidç‰ˆæœ¬** è¿›è¡Œå¤šæ¬¡ç‚¹å‡»ä¼šè§¦å‘å¼€å¯å¼€å‘è€…é€‰é¡¹ï¼Œç„¶åè¿›å…¥å¼€å‘è€…é€‰é¡¹é¡µé¢ï¼Œå¼€å¯USBè°ƒè¯•ã€‚

ä¸ºäº†é¿å…æ¯æ¬¡è°ƒè¯•æ—¶çœ‹åˆ°æ­¤è­¦å‘Šï¼Œå‹¾é€‰â€œ**æ€»æ˜¯å…è®¸ä»è¿™å°è®¡ç®—æœº**â€ï¼Œå¹¶å•å‡»â€œ**ç¡®å®š**â€ã€‚

**1.4 åœ¨ Chrome ä¸­å¯ç”¨è®¾ç½®â€œUSB web debuggingâ€ï¼ˆä¸ä¼šå½±å“WebViewï¼‰ï¼š**  


åœ¨ Chrome ä¸Šè®¿é—® `chrome://inspect/#devices` æˆ– `about:inspect` è®¿é—®å·²å¯ç”¨è°ƒè¯•çš„ WebView åˆ—è¡¨ï¼Œ**éœ€è¦ç¿»å¢™**ã€‚

ç„¶ååœ¨ WebView åˆ—è¡¨ä¸­é€‰æ‹©ä½ è¦è°ƒè¯•çš„é¡µé¢ï¼Œç‚¹å‡»â€œ `Inspect` â€é€‰é¡¹ï¼Œè·Ÿè°ƒè¯• PC ç½‘é¡µä¸€æ ·ï¼Œä½¿ç”¨ Chrome æ§åˆ¶å°è¿›è¡Œè°ƒè¯•ã€‚   

![Chrome æ§åˆ¶å°](http://images.pingan8787.com/20190707hybrid01.png)

![Chrome æ§åˆ¶å°](http://images.pingan8787.com/20190707hybrid02.png)

**1.5 å°æŠ€å·§ï¼š**   

ï¼ˆ1ï¼‰è®¿é—® `chrome://inspect/#devices` å¦‚æœ chrome æ²¡æœ‰æ£€æµ‹åˆ° `Remote Target` ä¸­çš„é¡µé¢ï¼Œå¯èƒ½éœ€è¦å®‰è£…ä¸€ä¸‹ Chrome çš„ ADB æ’ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ Chrome ç¿»å¢™è®¿é—® `https://chrome-devtools-frontend.appspot.com`ï¼›

ï¼ˆ2ï¼‰å¯¹äºè…¾è®¯ç³»çš„ APPï¼Œé»˜è®¤é‡‡ç”¨ X5å†…æ ¸ ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ APP å†…éƒ¨æ‰“å¼€ `https://debugx5.qq.com/` æ¥ä½¿ç”¨å®ƒçš„**Vconsoleè°ƒè¯•å·¥å…·**è¿›è¡Œè°ƒè¯•ã€‚


#### 2. ä½¿ç”¨ DebugGap è°ƒè¯•

> å‚è€ƒæ–‡ç« ï¼š[ã€ŠAndroidä¸‹çš„webviewè°ƒè¯•ã€‹](https://segmentfault.com/a/1190000009240637)

**2.1 Windows ä¸‹è½½ DebugGap å¹¶é…ç½®ï¼š**   

åœ¨ç”µè„‘ä¸Šé¢ä¸‹è½½ Windows ç‰ˆæœ¬çš„ `DebugGap` è½¯ä»¶åŒ…ï¼ˆä¸‹è½½é“¾æ¥ï¼š[DebugGap](http://www.debuggap.com/)ï¼‰ï¼Œä¸‹è½½å®Œæˆåè§£å‹ä¸‹æ¥ã€‚

å®‰è£…å®Œæˆåï¼Œè¿è¡Œ `DebugGap` ï¼Œå¼€å§‹é…ç½®ï¼š

* é€šå¸¸æƒ…å†µä¸‹ï¼Œ`DebugGap` å¯ä»¥è‡ªåŠ¨è·å–IPï¼Œå¹¶è®¾ç½®é»˜è®¤çš„ç«¯å£ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä½ å¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼›
* ç‚¹å‡»â€œ**è¿æ¥**â€æŒ‰é’®å¯åŠ¨å„ç§å®¢æˆ·ç«¯çš„ä¾¦å¬å™¨ï¼›

![DebugGap](http://images.pingan8787.com/20190707hybrid03.png)

**2.2 åœ¨å®¢æˆ·ç«¯ä¸Šé…ç½®ï¼š**

åœ¨è°ƒè¯•é¡¹ç›®ä¸­è¦è¿›è¡Œæµ‹è¯•çš„ HTML ç•Œé¢ä¸­å¼•å…¥ `debuggap.js`ã€‚
```html
<script src="debuggap.js" type="text/javascript"></script>
```

å½“è°ƒè¯•é¡¹ç›®çš„åŠ è½½æ—¶ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå°†ä¼šæœ‰ä¸€ä¸ªè“è‰²çš„åœ°æ–¹ï¼Œç‚¹å‡»ä¼šå‡ºç°ä¸€ä¸ªå››å¶ä¸‰å¶è‰çš„ä¸œè¥¿ï¼Œç‚¹å‡»â€œ**é…ç½®**â€ï¼Œæ˜¾ç¤ºé…ç½®é¡µé¢ã€‚è¾“å…¥ä¸è¿œç¨‹ DebugGap ä¸Šçš„ä¸»æœºå’Œç«¯å£ç›¸åŒçš„ä¸»æœºå’Œç«¯å£ï¼Œä¾‹å¦‚ `192.168.1.4:11111`ï¼Œç„¶åç‚¹å‡»â€œ**è¿æ¥**â€æŒ‰é’®ã€‚

![DebugGap](http://images.pingan8787.com/20190707hybrid04.png)

1.4ç”µè„‘ç«¯è¿œç¨‹ DebugGap å°†æ£€æµ‹å³å°†åˆ°æ¥çš„å®¢æˆ·ç«¯ï¼Œå¼€å‘äººå‘˜å¯ä»¥å•å‡»æ¯ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè°ƒè¯•ã€‚

![DebugGap](http://images.pingan8787.com/20190707hybrid05.png)

### å…­ã€åœ¨ iOS å¹³å°ä¸‹å¦‚ä½•è°ƒè¯• WebViewï¼Ÿ

> å‚è€ƒæ–‡ç« ï¼š[ã€ŠiOSä¹‹Safariè°ƒè¯•webView/H5é¡µé¢ã€‹](https://www.cnblogs.com/dianming/p/6902442.html)

ä¸€èˆ¬æˆ‘ä»¬é€šè¿‡ Mac çš„ Safariæµè§ˆå™¨ æ¥è°ƒè¯•ï¼Œä½†æ˜¯è¦æ³¨æ„ä¸¤ç‚¹ï¼š

* å¦‚æœè°ƒè¯•çš„æ˜¯ APP ä¸­ WebView çš„é¡µé¢ï¼Œåˆ™éœ€è¦è¿™ä¸ª APP çš„åŒ…æ”¯æŒè°ƒè¯•ï¼Œå¦‚æœä¸èƒ½è°ƒè¯•ï¼Œéœ€è¦è®© iOS å¼€å‘äººå‘˜é‡ç­¾å APPï¼ˆå¯èƒ½éœ€è¦å°†æˆ‘ä»¬ iOS è®¾å¤‡çš„ ID å†™å…¥åˆ°å¯ä¿¡ä»»è®¾å¤‡åˆ—è¡¨ä¸­ï¼Œç„¶åä½¿ç”¨ iTunes å®‰è£…å®¢æˆ·ç«¯æä¾›çš„æµ‹è¯•åŒ…å³å¯ï¼‰ã€‚

* å¦‚æœè°ƒè¯•çš„æ˜¯ H5 é¡µé¢ï¼Œå¯ä»¥ç›´æ¥åœ¨æ‰‹æœºçš„ Safariæµè§ˆå™¨ æ‰“å¼€ç›´æ¥è°ƒè¯•ã€‚   

ä¸‹é¢å¼€å§‹è¯´è¯´åœ¨ Mac ä¸Šå¦‚ä½•è°ƒè¯•ï¼š   

#### 1. å¼€å¯ Safari å¼€å‘èœå•

å…ˆå°† iPhone è¿æ¥åˆ° Macï¼Œåœ¨ Mac çš„ Safari åå¥½è®¾ç½®ä¸­ï¼Œå¼€å¯å¼€å‘èœå•ã€‚å…·ä½“æ­¥éª¤ä¸ºï¼šSafari -> åå¥½è®¾ç½®â€¦ -> é«˜çº§ -> å‹¾é€‰åœ¨èœå•æ æ˜¾ç¤ºâ€œ**å¼€å‘**â€èœå•ã€‚

![Safari](http://images.pingan8787.com/20190707hybrid06.jpg)


#### 2. iPhone å¼€å¯ Webæ£€æŸ¥å™¨

å…·ä½“æ­¥éª¤ä¸ºï¼šè®¾ç½® -> Safari -> é«˜çº§ -> Web æ£€æŸ¥å™¨ã€‚

![Safari](http://images.pingan8787.com/20190707hybrid07.jpg)

#### 3. è°ƒè¯• APP å†…çš„ WebView

> å‚è€ƒæ–‡ç« ï¼š[ã€Šå‰ç«¯ WEBVIEW æŒ‡å—ä¹‹ IOS è°ƒè¯•ç¯‡ã€‹](https://imnerd.org/ios-webview-debug.html)

åœ¨ Safari-> å¼€å‘ä¸­ï¼Œçœ‹åˆ°è‡ªå·±çš„è®¾å¤‡ä»¥åŠ WebView ä¸­ç½‘é¡µï¼Œç‚¹å‡»åå³å¯å¼€å¯å¯¹åº”é¡µé¢çš„ `Inspector` ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œæ–­ç‚¹è°ƒè¯•ã€‚   

![Safari](http://images.pingan8787.com/20190707hybrid09.png)

![Safari](http://images.pingan8787.com/20190707hybrid10.png)



### ä¸ƒã€åœ¨å†…åµŒç‰ˆè°ƒè¯•è¿‡ç¨‹ä¸­ï¼ŒFiddler æˆ– Charles èƒ½èµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿ 

è¿™ä¸¤è€…éƒ½æ˜¯å¼ºå¤§çš„æŠ“åŒ…å·¥å…·ï¼ŒåŸç†æ˜¯ä»¥**webä»£ç†æœåŠ¡å™¨**çš„å½¢å¼è¿›è¡Œå·¥ä½œçš„ï¼Œä½¿ç”¨çš„ä»£ç†åœ°å€æ˜¯ï¼š`127.0.0.1`ï¼Œç«¯å£é»˜è®¤ä¸º`8888`ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®è¿›è¡Œä¿®æ”¹ã€‚

**ä»£ç†**å°±æ˜¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è®¾ç½®ä¸€é“å…³å¡ï¼Œå®¢æˆ·ç«¯å…ˆå°†è¯·æ±‚æ•°æ®å‘é€å‡ºå»åï¼Œä»£ç†æœåŠ¡å™¨ä¼šå°†æ•°æ®åŒ…è¿›è¡Œæ‹¦æˆªï¼Œä»£ç†æœåŠ¡å™¨å†å†’å……å®¢æˆ·ç«¯å‘é€æ•°æ®åˆ°æœåŠ¡å™¨ï¼›åŒç†ï¼ŒæœåŠ¡å™¨å°†å“åº”æ•°æ®è¿”å›ï¼Œä»£ç†æœåŠ¡å™¨ä¹Ÿä¼šå°†æ•°æ®æ‹¦æˆªï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

Fiddler æˆ– Charles çš„ä¸»è¦ä½œç”¨æœ‰ï¼š   

* å¯ä»¥ä»£ç†è¯·æ±‚ï¼Œç”¨æ¥æŸ¥çœ‹é¡µé¢å‘é€çš„è¯·æ±‚å’Œæ¥æ”¶çš„å“åº”ï¼›
* å¯ä»¥ä¿®æ”¹è¯·æ±‚çš„å“åº”ï¼Œç”¨æ¥æ¨¡æ‹Ÿè‡ªå·±æƒ³è¦çš„æ•°æ®ï¼›
* å¯ä»¥æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„é€Ÿåº¦ï¼›
* å¯ä»¥ä»£ç†æœåŠ¡å™¨çš„é™æ€èµ„æºè¯·æ±‚ï¼ŒæŒ‡å‘æœ¬åœ°æ–‡ä»¶ï¼Œçœå»é¢‘ç¹å‘å¸ƒ H5 åŒ…ï¼Œè¾¾åˆ°å¿«é€Ÿè°ƒè¯•ç›®çš„ï¼›

> è¡¥å……é“¾æ¥ï¼š[ã€ŠFiddlerå·¥å…·ä½¿ç”¨ä»‹ç»ä¸€ã€‹](https://www.cnblogs.com/miantest/p/7289694.html)

### å…«ã€è°ƒè¯•ä¼ä¸šå¾®ä¿¡ã€å¾®ä¿¡å’Œé’‰é’‰ç‰ˆæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å“ªäº›å·¥å…·ï¼Ÿ

#### 1. è°ƒè¯•ä¼ä¸šå¾®ä¿¡ã€å¾®ä¿¡

* **[å¾®ä¿¡å¼€å‘è€…å·¥å…·](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)**ï¼Œå¯ä»¥ç”¨æ¥è°ƒè¯•é¡µé¢åŸºæœ¬åŠŸèƒ½ï¼›
* **[ä¼ä¸šå¾®ä¿¡æ¥å£è°ƒè¯•å·¥å…·](https://work.weixin.qq.com/api/devtools/devtool.php)**ï¼Œå¯ä»¥ç”¨æ¥è°ƒè¯•ä¼ä¸šå¾®ä¿¡çš„æ¥å£ï¼›

#### 2. è°ƒè¯•é’‰é’‰

* **[é’‰é’‰Androidå¼€å‘ç‰ˆ](https://files.alicdn.com/tpsservice/76ac853fc96075414a837d8bbae89030.pdf)**ï¼Œç”¨æ¥è°ƒè¯•Androidä¸Šçš„é’‰é’‰åº”ç”¨ï¼›

#### 3. é€šç”¨

* **Fiddler æˆ– Charles**ï¼Œå¯ä»¥æ‹¦æˆªæ¥å£æ›¿æ¢æ–‡ä»¶ï¼Œæ¥è°ƒè¯•åº”ç”¨ï¼›

### ä¹ã€å¸¸è§çš„è°ƒè¯•æŠ€å·§æœ‰å“ªäº›ï¼Ÿ

#### 1. Chrome æ§åˆ¶å°è°ƒè¯•

> å‚è€ƒæ–‡ç« ï¼š[ã€Šå‰ç«¯å¸¸è§è°ƒè¯•æŠ€å·§ç¯‡æ€»ç»“ï¼ˆæŒç»­æ›´æ–°...ï¼‰ã€‹](https://www.cnblogs.com/chenbeibei520/p/9959555.html)

**1.1 Source é¢æ¿æ–­ç‚¹è°ƒè¯• JS**  
ä»å·¦åˆ°å³ï¼Œå„ä¸ªå›¾æ ‡è¡¨ç¤ºçš„åŠŸèƒ½åˆ†åˆ«ä¸ºï¼š

* `Pause/Resume script execution`ï¼šæš‚åœ/æ¢å¤è„šæœ¬æ‰§è¡Œï¼ˆç¨‹åºæ‰§è¡Œåˆ°ä¸‹ä¸€æ–­ç‚¹åœæ­¢ï¼‰ã€‚
* `Step over next function call`ï¼šæ‰§è¡Œåˆ°ä¸‹ä¸€æ­¥çš„å‡½æ•°è°ƒç”¨ï¼ˆè·³åˆ°ä¸‹ä¸€è¡Œï¼‰ã€‚
* `Step into next function call`ï¼šè¿›å…¥å½“å‰å‡½æ•°ã€‚
* `Step out of current function`ï¼šè·³å‡ºå½“å‰æ‰§è¡Œå‡½æ•°ã€‚
* `Deactive/Active all breakpoints`ï¼šå…³é—­/å¼€å¯æ‰€æœ‰æ–­ç‚¹ï¼ˆä¸ä¼šå–æ¶ˆï¼‰ã€‚
* `Pause on exceptions`ï¼šå¼‚å¸¸æƒ…å†µè‡ªåŠ¨æ–­ç‚¹è®¾ç½®ã€‚

**1.2 Element é¢æ¿è°ƒè¯• DOMï¼š**   

å³å‡»å…ƒç´ ï¼Œé€‰æ‹© `break on` é€‰é¡¹ï¼š  

![break on](http://images.pingan8787.com/20190707hybrid14.png)

* `Subtree modifications` é€‰é¡¹ï¼Œæ˜¯æŒ‡**å½“èŠ‚ç‚¹å†…éƒ¨å­èŠ‚ç‚¹å˜åŒ–æ—¶æ–­ç‚¹**ï¼›    

![break on](http://images.pingan8787.com/20190707hybrid11.gif)

* `Attributes modifications` é€‰é¡¹ï¼Œæ˜¯æŒ‡**å½“èŠ‚ç‚¹å±æ€§å‘ç”Ÿå˜åŒ–æ—¶æ–­ç‚¹**ï¼›   

![break on](http://images.pingan8787.com/20190707hybrid12.gif)

* `node removal` é€‰é¡¹ï¼Œæ˜¯æŒ‡**å½“èŠ‚ç‚¹è¢«ç§»é™¤æ—¶æ–­ç‚¹**ï¼›   

![break on](http://images.pingan8787.com/20190707hybrid13.png)


#### 2. console è°ƒè¯•

> å‚è€ƒæ–‡ç« ï¼š[ã€ŠConsoleè°ƒè¯•å¸¸ç”¨ç”¨æ³•ã€‹](https://blog.csdn.net/a0405221/article/details/85248433)

**2.1 æ˜¾ç¤ºä¿¡æ¯çš„å‘½ä»¤ï¼š** 

```js
console.log("normal");         // ç”¨äºè¾“å‡ºæ™®é€šä¿¡æ¯
console.info("information");   // ç”¨äºè¾“å‡ºæç¤ºæ€§ä¿¡æ¯
console.error("error");        // ç”¨äºè¾“å‡ºé”™è¯¯ä¿¡æ¯
console.warn("warn");          // ç”¨äºè¾“å‡ºè­¦ç¤ºä¿¡æ¯
console.clear();               // æ¸…ç©ºæ§åˆ¶å°ä¿¡æ¯
```

**2.2 è®¡æ—¶åŠŸèƒ½ï¼š**   

`console.time()` å’Œ `console.timeEnd()` ï¼š

```js
console.time("æ§åˆ¶å°è®¡æ—¶å™¨");
for(var i = 0; i < 10000; i++){
    for(var j = 0; j < 10000; j++){}       
}
console.timeEnd("æ§åˆ¶å°è®¡æ—¶å™¨")
```

**2.3 ä¿¡æ¯åˆ†ç»„ï¼š**   

`console.group()` å’Œ `console.groupEnd()`ï¼š   

```js
console.group("ç¬¬ä¸€ç»„ä¿¡æ¯");
    console.log("ç¬¬ä¸€ç»„ç¬¬ä¸€æ¡ï¼šæˆ‘çš„åšå®¢");
    console.log("ç¬¬ä¸€ç»„ç¬¬äºŒæ¡ï¼šCSDN");
console.groupEnd();

console.group("ç¬¬äºŒç»„ä¿¡æ¯");
    console.log("ç¬¬äºŒç»„ç¬¬ä¸€æ¡ï¼šç¨‹åºçˆ±å¥½è€…QQç¾¤");
    console.log("ç¬¬äºŒç»„ç¬¬äºŒæ¡ï¼šæ¬¢è¿ä½ åŠ å…¥");
console.groupEnd();
```

**2.4 å°†å¯¹è±¡ä»¥æ ‘çŠ¶ç»“æ„å±•ç°ï¼š**   

`console.dir()` å¯ä»¥æ˜¾ç¤ºä¸€ä¸ªå¯¹è±¡æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼š   

```js
var info = {
    name : "Alan",
    age : "27",
    grilFriend : "nothing",
    getName : function(){
        return this.name;
    }
}
console.dir(info);
```

**2.5 æ˜¾ç¤ºæŸä¸ªèŠ‚ç‚¹çš„å†…å®¹ï¼š**   

`console.dirxml()` ç”¨æ¥æ˜¾ç¤ºç½‘é¡µçš„æŸä¸ªèŠ‚ç‚¹( `node`) æ‰€åŒ…å«çš„ `html/xml` ä»£ç ï¼š   

```js
var node = document.getElementById("info");
node.innerHTML += "<p>è¿½åŠ çš„å…ƒç´ æ˜¾ç¤ºå—</p>";
console.dirxml(node);
```

**2.5 ç»Ÿè®¡ä»£ç è¢«æ‰§è¡Œçš„æ¬¡æ•°ï¼š**  

ä½¿ç”¨ `console.count()`ï¼š   

```js
function myFunction(){
    console.count("myFunction è¢«æ‰§è¡Œçš„æ¬¡æ•°");
}
myFunction();       //myFunction è¢«æ‰§è¡Œçš„æ¬¡æ•°: 1
myFunction();       //myFunction è¢«æ‰§è¡Œçš„æ¬¡æ•°: 2
myFunction();       //myFunction è¢«æ‰§è¡Œçš„æ¬¡æ•°: 3
```

**2.6 è¾“å‡ºè¡¨æ ¼ï¼š**   

```js
console.table(mytable);
```

#### 3. è°ƒè¯•å„ç§é¡µé¢å°ºå¯¸

è™½ç„¶æŠŠå„ç§å„æ ·çš„æ‰‹æœºéƒ½æ‘†åœ¨æ¡Œå­ä¸Šçœ‹èµ·æ¥å¾ˆé…·ï¼Œä½†å´å¾ˆä¸ç°å®ã€‚ä½†æ˜¯ï¼Œæµè§ˆå™¨å†…å´æä¾›äº†ä½ æ‰€éœ€è¦çš„ä¸€åˆ‡ã€‚è¿›å…¥æ£€æŸ¥é¢æ¿ç‚¹å‡»â€œ**åˆ‡æ¢è®¾å¤‡æ¨¡å¼**â€æŒ‰é’®ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥åœ¨çª—å£å†…è°ƒæ•´è§†çª—çš„å¤§å°ã€‚


#### 4. debugger æ–­ç‚¹

å…·ä½“çš„è¯´å°±æ˜¯é€šè¿‡åœ¨ä»£ç ä¸­æ·»åŠ " `debugger; `"è¯­å¥ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°è¯¥è¯­å¥çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æ–­ç‚¹ã€‚  

![debugger](http://images.pingan8787.com/20190712Hybrid02.gif)



### ç»“è¯­

å¯¹äºåˆå…¥æ··åˆåº”ç”¨å¼€å‘çš„å°ä¼™ä¼´ï¼Œè¿˜æœ‰ç»å¸¸éœ€è¦è°ƒè¯•æ··åˆåº”ç”¨çš„å°ä¼™ä¼´ï¼Œç›¸ä¿¡ä¼šæœ‰å¸®åŠ©ğŸ˜

å¤§å®¶åŠ æ²¹~

### å…³äºæˆ‘

> æœ¬æ–‡é¦–å‘åœ¨ [pingan8787ä¸ªäººåšå®¢](http://www.pingan8787.com)ï¼Œå¦‚éœ€è½¬è½½è¯·ä¿ç•™ä¸ªäººä»‹ç»ã€‚

|Author|ç‹å¹³å®‰|
|---|---|
|E-mail|pingan8787@qq.com|
|åš  å®¢|www.pingan8787.com|
|å¾®  ä¿¡|pingan8787|
|æ¯æ—¥æ–‡ç« æ¨è|https://github.com/pingan8787/Leo_Reading/issues|
|ESå°å†Œ|js.pingan8787.com|

### å¾®ä¿¡å…¬ä¼—å·
![bg](http://images.pingan8787.com/2019_07_12guild_page.png)  