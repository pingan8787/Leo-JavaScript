<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>æ–‡ä»¶ä¸Šä¼ å¤„ç†</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/spark-md5/3.0.0/spark-md5.min.js"></script>
    <script src="./utils/index.js"></script>
    <!--
        ä¸€ä¸ªå®æˆ˜ä½œä¸šï¼Œè¦æ±‚å®ç°ä¸€ä¸ªæœ¬åœ°é€‰æ‹©/æ‹–æ‹½å›¾ç‰‡ä¸Šä¼ çš„åŠŸèƒ½ï¼š
        1ã€æ”¯æŒå¤šå¼ å›¾ç‰‡ä¸Šä¼  ğŸ‘
        2ã€æ”¯æŒä¸Šä¼ è¿›åº¦æ˜¾ç¤º ğŸ‘
        3ã€æ”¯æŒå›¾ç‰‡æœ¬åœ°é¢„è§ˆ
        æ³¨æ„äº‹é¡¹ï¼šéœ€è¦è€ƒè™‘å›¾ç‰‡ç±»å‹ã€å›¾ç‰‡å¤§å°æ ¡éªŒã€æ‹–æ‹½æ•ˆæœ
    -->
    <style>
        #previewContainer img {
            width: 300px;
            display: block;
        }
    </style>
</head>

<body>
    <input type="file" multiple id="selectUpload" onchange="changeFile(event)">
    <button id="submit" onclick="uploadFile()">å¼€å§‹ä¸Šä¼ </button>
    <div id="progressContainer">
        å½“å‰ä¸Šä¼ æ–‡ä»¶è¿›åº¦ï¼š<span id="progressNumber">-</span>%ï¼Œæ€»è€—æ—¶ï¼š<span id="progressTime">-</span>æ¯«ç§’ã€‚
    </div>

    <div id="previewContainer">
        <!-- åŠ¨æ€åˆ›å»º img æ ‡ç­¾ï¼Œå› ä¸ºå­˜åœ¨å¤šå¼ å›¾ç‰‡çš„æƒ…å†µ -->
    </div>

    <script>
        const uploadEle = document.querySelector("#selectUpload");
        const previewContainer = document.querySelector("#previewContainer");
        const request = axios.create({
            baseURL: "http://localhost:3000/upload/",
            timeout: 10000,
            xsrfCookieName: 'LEO-XSRF-TOKEN',
            xsrfHeaderName: 'LEO-X-XSRF-TOKEN',
            onUploadProgress: uploadProgress,
            onDownloadProgress: downloadProgress
        });

        const changeFile = async (event) => {
            const files = event.target.files;
            console.log("---", files)
            for (let item of files) {
                item && await createPreviewItem(previewContainer, item);
            }
        }

        const uploadFile = async () => {
            try {
                const files = uploadEle.files;
                const uploadAPI = files.length > 1 ? "multiple" : "single"; // åˆ¤æ–­å•é€‰è¿˜æ˜¯å¤šé€‰
                const formData = new FormData();
                for (let item of files) {
                    const fileIsImage = await isImage(item); // åˆ¤æ–­æ˜¯å¦ä¸ºå›¾ç‰‡ï¼Œåªä¸Šä¼ å›¾ç‰‡
                    fileIsImage && formData.append("file", item);
                }
                const result = await request.post(uploadAPI, formData);
            } catch (error) {
                console.log(error)
            }
        }

    </script>

</body>

</html>